<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>APPENDIX - Data wrangling and visualisation | Introduction to statistical data analysis in R</title>
  <meta name="description" content="Intro to Stats with R" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="APPENDIX - Data wrangling and visualisation | Introduction to statistical data analysis in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Intro to Stats with R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="APPENDIX - Data wrangling and visualisation | Introduction to statistical data analysis in R" />
  
  <meta name="twitter:description" content="Intro to Stats with R" />
  

<meta name="author" content="Mario Recker" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="appendix---general-introduction-to-rrstudio.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script language="javascript"> 
    function toggle(id) {
        var ele = document.getElementById("toggleText" + id);
        var text = document.getElementById("displayText" + id);
        var buttonText = text.innerHTML.replace("Show: ", "");
        buttonText = buttonText.replace("Hide: ", "");
        if(ele.style.display == "block") {
            ele.style.display = "none";
            text.innerHTML = "Show: " + buttonText;
        } else {
            ele.style.display = "block";
            text.innerHTML = "Hide: " + buttonText;
        }
    } 
</script>

<script language="javascript">
    function openCode(evt, codeName, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent" + id);
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks" + id);
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(codeName).style.display = "block";
        evt.currentTarget.className += " active";
    }
</script>

<script language="javascript">
    function hide(id){
        document.getElementById(id).style.display = "none";
    }
</script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">



<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#workshop-structure"><i class="fa fa-check"></i>Workshop structure</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="data-handling-and-visualisation.html"><a href="data-handling-and-visualisation.html"><i class="fa fa-check"></i><b>1</b> Data handling and visualisation</a>
<ul>
<li class="chapter" data-level="" data-path="data-handling-and-visualisation.html"><a href="data-handling-and-visualisation.html#introduction"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="data-handling-and-visualisation.html"><a href="data-handling-and-visualisation.html#loading-and-saving-data"><i class="fa fa-check"></i>Loading and saving data</a>
<ul>
<li class="chapter" data-level="" data-path="data-handling-and-visualisation.html"><a href="data-handling-and-visualisation.html#save-load-data-as-an-r-object"><i class="fa fa-check"></i>Save / load data as an R object</a></li>
<li class="chapter" data-level="" data-path="data-handling-and-visualisation.html"><a href="data-handling-and-visualisation.html#save-load-as-a-csv-file"><i class="fa fa-check"></i>Save / load as a CSV file</a></li>
<li class="chapter" data-level="" data-path="data-handling-and-visualisation.html"><a href="data-handling-and-visualisation.html#handling-excel-files"><i class="fa fa-check"></i>Handling Excel files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-statistical-modelling-in-r.html"><a href="introduction-to-statistical-modelling-in-r.html"><i class="fa fa-check"></i><b>2</b> Introduction to statistical modelling in R</a>
<ul>
<li class="chapter" data-level="" data-path="introduction-to-statistical-modelling-in-r.html"><a href="introduction-to-statistical-modelling-in-r.html#what-is-a-statistical-model"><i class="fa fa-check"></i>What is a statistical model?</a></li>
<li class="chapter" data-level="" data-path="introduction-to-statistical-modelling-in-r.html"><a href="introduction-to-statistical-modelling-in-r.html#descriptive-vs.-inferential-statistics"><i class="fa fa-check"></i>Descriptive vs.Â inferential statistics</a></li>
<li class="chapter" data-level="2.1" data-path="introduction-to-statistical-modelling-in-r.html"><a href="introduction-to-statistical-modelling-in-r.html#univariate-analysis"><i class="fa fa-check"></i><b>2.1</b> Univariate analysis</a>
<ul>
<li class="chapter" data-level="" data-path="introduction-to-statistical-modelling-in-r.html"><a href="introduction-to-statistical-modelling-in-r.html#mean-vs.-median"><i class="fa fa-check"></i><strong>Mean vs.Â median</strong></a></li>
<li class="chapter" data-level="" data-path="introduction-to-statistical-modelling-in-r.html"><a href="introduction-to-statistical-modelling-in-r.html#interquartile-range"><i class="fa fa-check"></i><strong>Interquartile range</strong></a></li>
<li class="chapter" data-level="" data-path="introduction-to-statistical-modelling-in-r.html"><a href="introduction-to-statistical-modelling-in-r.html#skewness"><i class="fa fa-check"></i><strong>Skewness</strong></a></li>
<li class="chapter" data-level="" data-path="introduction-to-statistical-modelling-in-r.html"><a href="introduction-to-statistical-modelling-in-r.html#kurtosis"><i class="fa fa-check"></i><strong>Kurtosis</strong></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-statistical-modelling-in-r.html"><a href="introduction-to-statistical-modelling-in-r.html#multivariate-analysis"><i class="fa fa-check"></i><b>2.2</b> Multivariate analysis</a>
<ul>
<li class="chapter" data-level="" data-path="introduction-to-statistical-modelling-in-r.html"><a href="introduction-to-statistical-modelling-in-r.html#contingency-tables"><i class="fa fa-check"></i><strong>Contingency tables</strong></a></li>
<li class="chapter" data-level="" data-path="introduction-to-statistical-modelling-in-r.html"><a href="introduction-to-statistical-modelling-in-r.html#pearson-correlation"><i class="fa fa-check"></i><strong>Pearson correlation</strong></a></li>
<li class="chapter" data-level="" data-path="introduction-to-statistical-modelling-in-r.html"><a href="introduction-to-statistical-modelling-in-r.html#spearmans-rank-correlation"><i class="fa fa-check"></i><strong>Spearmanâs rank correlation</strong></a></li>
<li class="chapter" data-level="" data-path="introduction-to-statistical-modelling-in-r.html"><a href="introduction-to-statistical-modelling-in-r.html#correlation-vs.-causation"><i class="fa fa-check"></i><strong>Correlation vs.Â causation</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="linear-models-lm.html"><a href="linear-models-lm.html"><i class="fa fa-check"></i><b>3</b> Linear Models (LM)</a>
<ul>
<li class="chapter" data-level="3.1" data-path="linear-models-lm.html"><a href="linear-models-lm.html#simple-linear-regression"><i class="fa fa-check"></i><b>3.1</b> Simple linear regression</a></li>
<li class="chapter" data-level="3.2" data-path="linear-models-lm.html"><a href="linear-models-lm.html#linear-regression-in-r"><i class="fa fa-check"></i><b>3.2</b> Linear regression in R</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="linear-models-lm.html"><a href="linear-models-lm.html#using-the-summary-function"><i class="fa fa-check"></i><b>3.2.1</b> <strong>Using the <code>summary()</code> function</strong></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="linear-models-lm.html"><a href="linear-models-lm.html#model-checking"><i class="fa fa-check"></i><b>3.3</b> Model checking</a>
<ul>
<li class="chapter" data-level="" data-path="linear-models-lm.html"><a href="linear-models-lm.html#residuals-vs-fitted"><i class="fa fa-check"></i><strong>Residuals vs Fitted</strong></a></li>
<li class="chapter" data-level="" data-path="linear-models-lm.html"><a href="linear-models-lm.html#normal-q-q"><i class="fa fa-check"></i><strong>Normal Q-Q</strong></a></li>
<li class="chapter" data-level="" data-path="linear-models-lm.html"><a href="linear-models-lm.html#scale-location"><i class="fa fa-check"></i><strong>Scale-Location</strong></a></li>
<li class="chapter" data-level="" data-path="linear-models-lm.html"><a href="linear-models-lm.html#residuals-vs-leverage"><i class="fa fa-check"></i><strong>Residuals vs Leverage</strong></a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="linear-models-lm.html"><a href="linear-models-lm.html#prediction"><i class="fa fa-check"></i><b>3.4</b> Prediction</a></li>
<li class="chapter" data-level="3.5" data-path="linear-models-lm.html"><a href="linear-models-lm.html#multiple-linear-regression"><i class="fa fa-check"></i><b>3.5</b> Multiple linear regression</a></li>
<li class="chapter" data-level="3.6" data-path="linear-models-lm.html"><a href="linear-models-lm.html#categorical-explanatory-variables"><i class="fa fa-check"></i><b>3.6</b> Categorical explanatory variables</a></li>
<li class="chapter" data-level="3.7" data-path="linear-models-lm.html"><a href="linear-models-lm.html#interactions"><i class="fa fa-check"></i><b>3.7</b> Interactions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mixed-effect-models-mem.html"><a href="mixed-effect-models-mem.html"><i class="fa fa-check"></i><b>4</b> Mixed Effect Models (MEM)</a>
<ul>
<li class="chapter" data-level="4.1" data-path="mixed-effect-models-mem.html"><a href="mixed-effect-models-mem.html#model-checking-1"><i class="fa fa-check"></i><b>4.1</b> Model checking</a></li>
<li class="chapter" data-level="4.2" data-path="mixed-effect-models-mem.html"><a href="mixed-effect-models-mem.html#further-reading"><i class="fa fa-check"></i><b>4.2</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="generalised-linear-models-glm.html"><a href="generalised-linear-models-glm.html"><i class="fa fa-check"></i><b>5</b> Generalised Linear Models (GLM)</a>
<ul>
<li class="chapter" data-level="5.1" data-path="generalised-linear-models-glm.html"><a href="generalised-linear-models-glm.html#link-functions"><i class="fa fa-check"></i><b>5.1</b> Link functions</a></li>
<li class="chapter" data-level="5.2" data-path="generalised-linear-models-glm.html"><a href="generalised-linear-models-glm.html#poisson-regression-for-count-data"><i class="fa fa-check"></i><b>5.2</b> Poisson regression (for count data)</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="generalised-linear-models-glm.html"><a href="generalised-linear-models-glm.html#background"><i class="fa fa-check"></i><b>5.2.1</b> Background</a></li>
<li class="chapter" data-level="5.2.2" data-path="generalised-linear-models-glm.html"><a href="generalised-linear-models-glm.html#poisson-regression-in-r"><i class="fa fa-check"></i><b>5.2.2</b> Poisson regression in R</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="generalised-linear-models-glm.html"><a href="generalised-linear-models-glm.html#logistic-regression-for-binary-data"><i class="fa fa-check"></i><b>5.3</b> Logistic regression (for binary data)</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="generalised-linear-models-glm.html"><a href="generalised-linear-models-glm.html#background-1"><i class="fa fa-check"></i><b>5.3.1</b> Background</a></li>
<li class="chapter" data-level="5.3.2" data-path="generalised-linear-models-glm.html"><a href="generalised-linear-models-glm.html#logistic-regression-in-r"><i class="fa fa-check"></i><b>5.3.2</b> Logistic regression in R</a></li>
<li class="chapter" data-level="" data-path="generalised-linear-models-glm.html"><a href="generalised-linear-models-glm.html#odds-ratios"><i class="fa fa-check"></i>Odds ratios</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="survival-analysis.html"><a href="survival-analysis.html"><i class="fa fa-check"></i><b>6</b> Survival Analysis</a>
<ul>
<li class="chapter" data-level="6.1" data-path="survival-analysis.html"><a href="survival-analysis.html#terminology-and-notation"><i class="fa fa-check"></i><b>6.1</b> Terminology and notation</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="survival-analysis.html"><a href="survival-analysis.html#censoring"><i class="fa fa-check"></i><b>6.1.1</b> Censoring</a></li>
<li class="chapter" data-level="6.1.2" data-path="survival-analysis.html"><a href="survival-analysis.html#survival-and-hazard-functions"><i class="fa fa-check"></i><b>6.1.2</b> Survival and hazard functions</a></li>
<li class="chapter" data-level="6.1.3" data-path="survival-analysis.html"><a href="survival-analysis.html#calculating-survival-times-in-r"><i class="fa fa-check"></i><b>6.1.3</b> Calculating survival times in R</a></li>
<li class="chapter" data-level="6.1.4" data-path="survival-analysis.html"><a href="survival-analysis.html#r-libraries-and-example-data"><i class="fa fa-check"></i><b>6.1.4</b> R libraries and example data</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="survival-analysis.html"><a href="survival-analysis.html#kaplan-meier"><i class="fa fa-check"></i><b>6.2</b> Kaplan-Meier</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="survival-analysis.html"><a href="survival-analysis.html#median-survival-time"><i class="fa fa-check"></i><b>6.2.1</b> <strong>Median survival time</strong></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="survival-analysis.html"><a href="survival-analysis.html#cox-regression-model"><i class="fa fa-check"></i><b>6.3</b> Cox regression model</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix---general-introduction-to-rrstudio.html"><a href="appendix---general-introduction-to-rrstudio.html"><i class="fa fa-check"></i>APPENDIX - General introduction to R/RStudio</a>
<ul>
<li class="chapter" data-level="" data-path="appendix---general-introduction-to-rrstudio.html"><a href="appendix---general-introduction-to-rrstudio.html#setting-up-an-r-session"><i class="fa fa-check"></i>Setting up an R session</a></li>
<li class="chapter" data-level="" data-path="appendix---general-introduction-to-rrstudio.html"><a href="appendix---general-introduction-to-rrstudio.html#r-packages"><i class="fa fa-check"></i>R packages</a></li>
<li class="chapter" data-level="" data-path="appendix---general-introduction-to-rrstudio.html"><a href="appendix---general-introduction-to-rrstudio.html#variables-vectors-and-data-frames-in-r"><i class="fa fa-check"></i>Variables, vectors and data frames in R</a>
<ul>
<li class="chapter" data-level="" data-path="appendix---general-introduction-to-rrstudio.html"><a href="appendix---general-introduction-to-rrstudio.html#data-frames"><i class="fa fa-check"></i>Data frames</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix---general-introduction-to-rrstudio.html"><a href="appendix---general-introduction-to-rrstudio.html#functions-in-r"><i class="fa fa-check"></i>Functions in R</a>
<ul>
<li class="chapter" data-level="" data-path="appendix---general-introduction-to-rrstudio.html"><a href="appendix---general-introduction-to-rrstudio.html#useful-inbuilt-functions"><i class="fa fa-check"></i>Useful inbuilt functions</a></li>
<li class="chapter" data-level="" data-path="appendix---general-introduction-to-rrstudio.html"><a href="appendix---general-introduction-to-rrstudio.html#custom-functions"><i class="fa fa-check"></i>Custom functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix---general-introduction-to-rrstudio.html"><a href="appendix---general-introduction-to-rrstudio.html#basic-plotting-in-r"><i class="fa fa-check"></i>Basic plotting in R</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="appendix---general-introduction-to-rrstudio.html"><a href="appendix---general-introduction-to-rrstudio.html#scatter-plot"><i class="fa fa-check"></i><b>6.3.1</b> Scatter plot</a></li>
<li class="chapter" data-level="" data-path="appendix---general-introduction-to-rrstudio.html"><a href="appendix---general-introduction-to-rrstudio.html#line-graph"><i class="fa fa-check"></i>Line graph</a></li>
<li class="chapter" data-level="" data-path="appendix---general-introduction-to-rrstudio.html"><a href="appendix---general-introduction-to-rrstudio.html#combined-graph"><i class="fa fa-check"></i>Combined graph</a></li>
<li class="chapter" data-level="" data-path="appendix---general-introduction-to-rrstudio.html"><a href="appendix---general-introduction-to-rrstudio.html#barplot"><i class="fa fa-check"></i>Barplot</a></li>
<li class="chapter" data-level="" data-path="appendix---general-introduction-to-rrstudio.html"><a href="appendix---general-introduction-to-rrstudio.html#boxplots"><i class="fa fa-check"></i>Boxplots</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html"><i class="fa fa-check"></i>APPENDIX - Data wrangling and visualisation</a>
<ul>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#introduction-1"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#loading-and-saving-data-1"><i class="fa fa-check"></i>Loading and saving data</a>
<ul>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#save-load-data-as-an-r-object-1"><i class="fa fa-check"></i>Save / load data as an R object</a></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#save-load-as-a-csv-file-1"><i class="fa fa-check"></i>Save / load as a CSV file</a></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#handling-excel-files-1"><i class="fa fa-check"></i>Handling Excel files</a></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#cheatsheet"><i class="fa fa-check"></i>Cheatsheet</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#visualisation-using-ggplot"><i class="fa fa-check"></i>Visualisation using <code>ggplot</code></a>
<ul>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#aesthetics"><i class="fa fa-check"></i>Aesthetics</a></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#geoms"><i class="fa fa-check"></i>Geoms</a></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#labels"><i class="fa fa-check"></i>Labels</a></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#faceting"><i class="fa fa-check"></i>Faceting</a></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#statistical-transformation"><i class="fa fa-check"></i>Statistical transformation</a></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#scales"><i class="fa fa-check"></i>Scales</a></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#assigning-plots-to-objects"><i class="fa fa-check"></i>Assigning plots to objects</a></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#putting-it-all-together"><i class="fa fa-check"></i>Putting it all together</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#data-wrangling"><i class="fa fa-check"></i>Data wrangling</a>
<ul>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#tidy-data"><i class="fa fa-check"></i>Tidy data</a></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#filter-rows"><i class="fa fa-check"></i>Filter rows</a></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#sort-rows"><i class="fa fa-check"></i>Sort rows</a></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#select-columns"><i class="fa fa-check"></i>Select columns</a></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#grouping-and-summarising"><i class="fa fa-check"></i>Grouping and summarising</a></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#reshaping-datasets"><i class="fa fa-check"></i>Reshaping datasets</a></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#mutate"><i class="fa fa-check"></i>Mutate</a></li>
<li class="chapter" data-level="" data-path="appendix---data-wrangling-and-visualisation.html"><a href="appendix---data-wrangling-and-visualisation.html#dealing-with-missing-data"><i class="fa fa-check"></i>Dealing with missing data</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to statistical data analysis in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="appendix---data-wrangling-and-visualisation" class="section level1 unnumbered hasAnchor">
<h1>APPENDIX - Data wrangling and visualisation<a href="appendix---data-wrangling-and-visualisation.html#appendix---data-wrangling-and-visualisation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction-1" class="section level2 unnumbered hasAnchor">
<h2>Introduction<a href="appendix---data-wrangling-and-visualisation.html#introduction-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the second part of this workshop we are dealing with the handling and visualisation of (complex) data. It is expected that you should feel comfortable with basic R and, specifically, the use of data.frame objects. If not, then please ask one of the demonstrators.</p>
<p>At this point we are also saying goodbye to much of Râs basic (i.e.Â inbuilt) functionalities for plotting and manipulating data and introduce you to the <em>tidyverse</em>, which is a suite of packages for performing a (growing) number of data science tasks. Here, we will introduce key <code>tidyverse</code> packages, including <code>dplyr</code> and <code>ggplot2</code>, and show how they can be used to efficiently process and visualise complex data.</p>
<p>Although each package can be installed and loaded separately, they are designed to work together. An easier approach is to simply install and load the <code>tidyverse</code> directly.</p>
<p>To install tidyverse, use:</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="appendix---data-wrangling-and-visualisation.html#cb250-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<p>and once installed, it can be loaded using:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="appendix---data-wrangling-and-visualisation.html#cb251-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="loading-and-saving-data-1" class="section level2 unnumbered hasAnchor">
<h2>Loading and saving data<a href="appendix---data-wrangling-and-visualisation.html#loading-and-saving-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>An essential part of data handling is the ability to store and read (externally stored) data. There are a myriad of different ways this can be done, here we briefly introduce two of them:</p>
<ul>
<li>saving data as an R object with <code>saveRDS</code> to create an <code>Rds</code> files and loading it with <code>load</code></li>
<li>saving data as a <em>comma separated version</em> (CSV) file and loading it with <code>read_csv</code> or <code>read.table</code></li>
</ul>
<blockquote>
<p><strong>Note:</strong> <code>tidyverse</code> also provides functions to handle Microsoft Excel files. For example, <code>read_excel()</code> lets you import xls or xlsx based data files. However, due to Excel often causing havoc with data (mostly due to it changing data types), we are urging caution when handling Excel files.</p>
</blockquote>
<p>The main difference between the two approaches is that an <code>Rds</code> file stores data in a (R specific) binary format, meaning that you need R to read it. CSV files, in comparison, are (human readable) text files that can be opened by a number of different programs. In fact, on most operating systems, these are opened by MS Excel or a text editor by default. Which approach should you use? This often depends on whether you are the only one working with the data or whether you like the added benefit of viewing (or manipulating) data outside the R environment.</p>
<div id="save-load-data-as-an-r-object-1" class="section level3 unnumbered hasAnchor">
<h3>Save / load data as an R object<a href="appendix---data-wrangling-and-visualisation.html#save-load-data-as-an-r-object-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As a first step we need to create some data that we wish to store for future use. And as before, we are dealing almost exclusively with data.frames. Recall the simply data.frame we generated in the first session</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="appendix---data-wrangling-and-visualisation.html#cb252-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ParticipantID =</span> <span class="fu">c</span>(<span class="st">&#39;ID001&#39;</span>, <span class="st">&#39;ID002&#39;</span>, <span class="st">&#39;ID003&#39;</span>, <span class="st">&#39;ID007&#39;</span>, <span class="st">&#39;ID009&#39;</span>),</span>
<span id="cb252-2"><a href="appendix---data-wrangling-and-visualisation.html#cb252-2" tabindex="-1"></a>                 <span class="at">Age =</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">7</span>, <span class="dv">11</span>),</span>
<span id="cb252-3"><a href="appendix---data-wrangling-and-visualisation.html#cb252-3" tabindex="-1"></a>                 <span class="at">Episode =</span> <span class="fu">c</span>(<span class="st">&#39;y&#39;</span>, <span class="st">&#39;n&#39;</span>, <span class="st">&#39;n&#39;</span>, <span class="st">&#39;y&#39;</span>, <span class="st">&#39;y&#39;</span>))</span></code></pre></div>
<p>To save this data as an R object, simply call</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="appendix---data-wrangling-and-visualisation.html#cb253-1" tabindex="-1"></a><span class="fu">saveRDS</span>(df, <span class="at">file =</span> <span class="st">&#39;myData.Rds&#39;</span>)</span></code></pre></div>
<blockquote>
<p><strong>Note:</strong> the file will be saved in your current working directory. If you want to save it in a different folder you need to provide the full file path, e.g.Â <code>saveRDS(df, file = '.../StatsWithR//Data/myData.Rds')</code>.</p>
</blockquote>
<p>Loading the data is equally simple:</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="appendix---data-wrangling-and-visualisation.html#cb254-1" tabindex="-1"></a><span class="co"># first we remove the df object to make sure everything works</span></span>
<span id="cb254-2"><a href="appendix---data-wrangling-and-visualisation.html#cb254-2" tabindex="-1"></a><span class="fu">rm</span>(df)</span>
<span id="cb254-3"><a href="appendix---data-wrangling-and-visualisation.html#cb254-3" tabindex="-1"></a></span>
<span id="cb254-4"><a href="appendix---data-wrangling-and-visualisation.html#cb254-4" tabindex="-1"></a><span class="co"># load the data</span></span>
<span id="cb254-5"><a href="appendix---data-wrangling-and-visualisation.html#cb254-5" tabindex="-1"></a><span class="fu">readRDS</span>(<span class="st">&#39;myData.Rds&#39;</span>)</span></code></pre></div>
<pre><code>##   ParticipantID Age Episode
## 1         ID001  12       y
## 2         ID002   8       n
## 3         ID003   9       n
## 4         ID007   7       y
## 5         ID009  11       y</code></pre>
<p>At first sight this looks like it has worked. However, you might also have noticed that there is no newly created object in your global environment. This means, although R successfully loaded the data, it was not assigned to an object and essentially lost (this is one of the key differences between <code>save</code>/<code>load</code> and <code>saveRDS</code>/<code>readRDS</code>). We therefore need to assign the read in data to an object</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="appendix---data-wrangling-and-visualisation.html#cb256-1" tabindex="-1"></a><span class="co"># read data and assign to an object / data.frame called myData</span></span>
<span id="cb256-2"><a href="appendix---data-wrangling-and-visualisation.html#cb256-2" tabindex="-1"></a>myData <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&#39;myData.Rds&#39;</span>)</span>
<span id="cb256-3"><a href="appendix---data-wrangling-and-visualisation.html#cb256-3" tabindex="-1"></a></span>
<span id="cb256-4"><a href="appendix---data-wrangling-and-visualisation.html#cb256-4" tabindex="-1"></a><span class="co"># see if it works</span></span>
<span id="cb256-5"><a href="appendix---data-wrangling-and-visualisation.html#cb256-5" tabindex="-1"></a><span class="fu">head</span>(myData)</span></code></pre></div>
<pre><code>##   ParticipantID Age Episode
## 1         ID001  12       y
## 2         ID002   8       n
## 3         ID003   9       n
## 4         ID007   7       y
## 5         ID009  11       y</code></pre>
</div>
<div id="save-load-as-a-csv-file-1" class="section level3 unnumbered hasAnchor">
<h3>Save / load as a CSV file<a href="appendix---data-wrangling-and-visualisation.html#save-load-as-a-csv-file-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One of the advantages of saving data as an Rds file is that it is more space efficient. By default, <code>saveRDS</code> compresses the data, which can significantly shrink the size of the stored data. On the downside, it can also take a bit longer to load the data subsequently. The more preferred data format, however, is a CSV file.</p>
<p>There are two equivalent function pairs for saving / loading CSV files: <code>write.table()</code>/<code>read.table()</code> and <code>read_csv()</code>/<code>write_csv()</code> (the latter is essentially a wrapper for the former). Here we show you how to use the first function pair, but please familiarise yourself with the other one as well.</p>
<p>First we save our data.frame <code>myData</code> as a comma separated file</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="appendix---data-wrangling-and-visualisation.html#cb258-1" tabindex="-1"></a><span class="co"># save data in CSV format</span></span>
<span id="cb258-2"><a href="appendix---data-wrangling-and-visualisation.html#cb258-2" tabindex="-1"></a><span class="fu">write.table</span>(myData,  <span class="co"># data object</span></span>
<span id="cb258-3"><a href="appendix---data-wrangling-and-visualisation.html#cb258-3" tabindex="-1"></a>            <span class="at">file =</span> <span class="st">&#39;myData.csv&#39;</span>,  <span class="co"># file name</span></span>
<span id="cb258-4"><a href="appendix---data-wrangling-and-visualisation.html#cb258-4" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">&#39;,&#39;</span>, <span class="co"># character used to separate columns</span></span>
<span id="cb258-5"><a href="appendix---data-wrangling-and-visualisation.html#cb258-5" tabindex="-1"></a>            <span class="at">row.names =</span> F) <span class="co"># don&#39;t save row names as additional column</span></span></code></pre></div>
<p>Check if this worked by importing the CSV file</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="appendix---data-wrangling-and-visualisation.html#cb259-1" tabindex="-1"></a><span class="co"># first remove the object form our environment</span></span>
<span id="cb259-2"><a href="appendix---data-wrangling-and-visualisation.html#cb259-2" tabindex="-1"></a><span class="fu">rm</span>(myData)</span>
<span id="cb259-3"><a href="appendix---data-wrangling-and-visualisation.html#cb259-3" tabindex="-1"></a></span>
<span id="cb259-4"><a href="appendix---data-wrangling-and-visualisation.html#cb259-4" tabindex="-1"></a><span class="co"># read in data</span></span>
<span id="cb259-5"><a href="appendix---data-wrangling-and-visualisation.html#cb259-5" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&#39;myData.csv&#39;</span>,  <span class="co"># file name to be read</span></span>
<span id="cb259-6"><a href="appendix---data-wrangling-and-visualisation.html#cb259-6" tabindex="-1"></a>                 <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="co"># treat first row as header / column names</span></span>
<span id="cb259-7"><a href="appendix---data-wrangling-and-visualisation.html#cb259-7" tabindex="-1"></a>                 <span class="at">sep =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb259-8"><a href="appendix---data-wrangling-and-visualisation.html#cb259-8" tabindex="-1"></a></span>
<span id="cb259-9"><a href="appendix---data-wrangling-and-visualisation.html#cb259-9" tabindex="-1"></a><span class="co"># print out first three rows</span></span>
<span id="cb259-10"><a href="appendix---data-wrangling-and-visualisation.html#cb259-10" tabindex="-1"></a><span class="fu">head</span>(df, <span class="at">n =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##   ParticipantID Age Episode
## 1         ID001  12       y
## 2         ID002   8       n
## 3         ID003   9       n</code></pre>
<blockquote>
<p><strong>Note:</strong> here we used a comma (â,â) to separate individual data columns. Other commonly used characters are semi-colon (â;â) and tab (â). If the separation is not explicitly provided via <code>sep = ...</code>, <code>read.table</code> will guess it - this is dangerous and often leads to errors. We therefore recommend to always state which character should be used - <em>explicit is better than implicit</em>!</p>
</blockquote>
</div>
<div id="handling-excel-files-1" class="section level3 unnumbered hasAnchor">
<h3>Handling Excel files<a href="appendix---data-wrangling-and-visualisation.html#handling-excel-files-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Although we strongly discourage the use of Excel for data handling, it is still one of the most common methods for storing data. We therefore briefly show you one method of how to read Excel files using the <code>readxl</code> package, which needs to be loaded explicitly, because it is not one of the core tidyverse packages that are loaded via <code>library(tidyverse)</code></p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="appendix---data-wrangling-and-visualisation.html#cb261-1" tabindex="-1"></a><span class="co"># load library</span></span>
<span id="cb261-2"><a href="appendix---data-wrangling-and-visualisation.html#cb261-2" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb261-3"><a href="appendix---data-wrangling-and-visualisation.html#cb261-3" tabindex="-1"></a></span>
<span id="cb261-4"><a href="appendix---data-wrangling-and-visualisation.html#cb261-4" tabindex="-1"></a><span class="co"># read in excel data file</span></span>
<span id="cb261-5"><a href="appendix---data-wrangling-and-visualisation.html#cb261-5" tabindex="-1"></a>irisDF <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&#39;iris.xls&#39;</span>)</span>
<span id="cb261-6"><a href="appendix---data-wrangling-and-visualisation.html#cb261-6" tabindex="-1"></a></span>
<span id="cb261-7"><a href="appendix---data-wrangling-and-visualisation.html#cb261-7" tabindex="-1"></a><span class="co"># print first few rows</span></span>
<span id="cb261-8"><a href="appendix---data-wrangling-and-visualisation.html#cb261-8" tabindex="-1"></a><span class="fu">head</span>(irisDF, <span class="at">n =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 Ã 5
##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
##          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  
## 1          5.1         3.5          1.4         0.2 setosa 
## 2          4.9         3            1.4         0.2 setosa 
## 3          4.7         3.2          1.3         0.2 setosa 
## 4          4.6         3.1          1.5         0.2 setosa 
## 5          5           3.6          1.4         0.2 setosa</code></pre>
</div>
<div id="cheatsheet" class="section level3 unnumbered hasAnchor">
<h3>Cheatsheet<a href="appendix---data-wrangling-and-visualisation.html#cheatsheet" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For more information of how to import and export data have a look at this <a href="https://rstudio.github.io/cheatsheets/html/data-import.html">cheat sheet</a>, which also provides an overview of all essential functions and their usage as a PDF for download.</p>
<p><span class="math inline">\(~\)</span></p>
</div>
</div>
<div id="visualisation-using-ggplot" class="section level2 unnumbered hasAnchor">
<h2>Visualisation using <code>ggplot</code><a href="appendix---data-wrangling-and-visualisation.html#visualisation-using-ggplot" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We start with a motivating example to show, how using base R graphics can easily become cumbersome. For this we use the <code>iris</code> dataset, which we have imported in the previous section. This dataset contains the measurements of the sepal length, sepal width, petal length and petal width for 50 samples from each of three species of iris flowers (setosa, versicolor and virginica).</p>
<p>Letâs say we are interested in the relationship between the length and the width of the petals. The first port of call is therefore to plot one against the other.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="appendix---data-wrangling-and-visualisation.html#cb263-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> irisDF<span class="sc">$</span>Petal.Width, <span class="at">y =</span> irisDF<span class="sc">$</span>Petal.Length)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-174-1.png" style="display: block; margin: auto;" /></p>
<p>We can see that there is a clear relationship between those two variables. One other thing we might notice is that there are (at least) two clusters, and we might further have the suspicion that this could be due to the fact that we different species of iris. One way of checking this is to colour the points in by species. Here we do this in a slightly convoluted way but it serves the purpose of highlighting how quickly things can become complicated in base R.</p>
<p>The first thing we want to do is to subset the data. Say, for example, we are interested in the relationship between petal length and width in <em>Iris setosa</em>. In other words, we want to only plot the data for which <code>Species=='setosa'</code>.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="appendix---data-wrangling-and-visualisation.html#cb264-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> irisDF<span class="sc">$</span>Petal.Width[irisDF<span class="sc">$</span>Species<span class="sc">==</span><span class="st">&#39;setosa&#39;</span>], </span>
<span id="cb264-2"><a href="appendix---data-wrangling-and-visualisation.html#cb264-2" tabindex="-1"></a>     <span class="at">y =</span> irisDF<span class="sc">$</span>Petal.Length[irisDF<span class="sc">$</span>Species<span class="sc">==</span><span class="st">&#39;setosa&#39;</span>],</span>
<span id="cb264-3"><a href="appendix---data-wrangling-and-visualisation.html#cb264-3" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="at">pch =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-175-1.png" style="display: block; margin: auto;" /></p>
<p>We can now add point for samples from <em>Iris versicolor</em> in a similar fashion.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="appendix---data-wrangling-and-visualisation.html#cb265-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> irisDF<span class="sc">$</span>Petal.Width[irisDF<span class="sc">$</span>Species<span class="sc">==</span><span class="st">&#39;setosa&#39;</span>], </span>
<span id="cb265-2"><a href="appendix---data-wrangling-and-visualisation.html#cb265-2" tabindex="-1"></a>     <span class="at">y =</span> irisDF<span class="sc">$</span>Petal.Length[irisDF<span class="sc">$</span>Species<span class="sc">==</span><span class="st">&#39;setosa&#39;</span>],</span>
<span id="cb265-3"><a href="appendix---data-wrangling-and-visualisation.html#cb265-3" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb265-4"><a href="appendix---data-wrangling-and-visualisation.html#cb265-4" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span> irisDF<span class="sc">$</span>Petal.Width[irisDF<span class="sc">$</span>Species<span class="sc">==</span><span class="st">&#39;versicolor&#39;</span>], </span>
<span id="cb265-5"><a href="appendix---data-wrangling-and-visualisation.html#cb265-5" tabindex="-1"></a>       <span class="at">y =</span> irisDF<span class="sc">$</span>Petal.Length[irisDF<span class="sc">$</span>Species<span class="sc">==</span><span class="st">&#39;versicolor&#39;</span>],</span>
<span id="cb265-6"><a href="appendix---data-wrangling-and-visualisation.html#cb265-6" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">pch =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-176-1.png" style="display: block; margin: auto;" /></p>
<p>What has happened?? The problem is that the axes limits are automatically set through the first <code>plot</code> call and not updated for any additional points added to the graph. We therefore need to manually set the limits to guarantee that all points are visible.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="appendix---data-wrangling-and-visualisation.html#cb266-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> irisDF<span class="sc">$</span>Petal.Width[irisDF<span class="sc">$</span>Species<span class="sc">==</span><span class="st">&#39;setosa&#39;</span>], </span>
<span id="cb266-2"><a href="appendix---data-wrangling-and-visualisation.html#cb266-2" tabindex="-1"></a>     <span class="at">y =</span> irisDF<span class="sc">$</span>Petal.Length[irisDF<span class="sc">$</span>Species<span class="sc">==</span><span class="st">&#39;setosa&#39;</span>],</span>
<span id="cb266-3"><a href="appendix---data-wrangling-and-visualisation.html#cb266-3" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="at">pch =</span> <span class="dv">20</span>,</span>
<span id="cb266-4"><a href="appendix---data-wrangling-and-visualisation.html#cb266-4" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">2.5</span>),</span>
<span id="cb266-5"><a href="appendix---data-wrangling-and-visualisation.html#cb266-5" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">7</span>),</span>
<span id="cb266-6"><a href="appendix---data-wrangling-and-visualisation.html#cb266-6" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&#39;Petal width&#39;</span>,</span>
<span id="cb266-7"><a href="appendix---data-wrangling-and-visualisation.html#cb266-7" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&#39;Petal length&#39;</span>)</span>
<span id="cb266-8"><a href="appendix---data-wrangling-and-visualisation.html#cb266-8" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span> irisDF<span class="sc">$</span>Petal.Width[irisDF<span class="sc">$</span>Species<span class="sc">==</span><span class="st">&#39;versicolor&#39;</span>], </span>
<span id="cb266-9"><a href="appendix---data-wrangling-and-visualisation.html#cb266-9" tabindex="-1"></a>       <span class="at">y =</span> irisDF<span class="sc">$</span>Petal.Length[irisDF<span class="sc">$</span>Species<span class="sc">==</span><span class="st">&#39;versicolor&#39;</span>],</span>
<span id="cb266-10"><a href="appendix---data-wrangling-and-visualisation.html#cb266-10" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb266-11"><a href="appendix---data-wrangling-and-visualisation.html#cb266-11" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span> irisDF<span class="sc">$</span>Petal.Width[irisDF<span class="sc">$</span>Species<span class="sc">==</span><span class="st">&#39;virginica&#39;</span>], </span>
<span id="cb266-12"><a href="appendix---data-wrangling-and-visualisation.html#cb266-12" tabindex="-1"></a>       <span class="at">y =</span> irisDF<span class="sc">$</span>Petal.Length[irisDF<span class="sc">$</span>Species<span class="sc">==</span><span class="st">&#39;virginica&#39;</span>],</span>
<span id="cb266-13"><a href="appendix---data-wrangling-and-visualisation.html#cb266-13" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&#39;darkgreen&#39;</span>, <span class="at">pch =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-177-1.png" style="display: block; margin: auto;" /></p>
<p>The only thing missing now is a legend to note which colour belongs to what species.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="appendix---data-wrangling-and-visualisation.html#cb267-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> irisDF<span class="sc">$</span>Petal.Width[irisDF<span class="sc">$</span>Species<span class="sc">==</span><span class="st">&#39;setosa&#39;</span>], </span>
<span id="cb267-2"><a href="appendix---data-wrangling-and-visualisation.html#cb267-2" tabindex="-1"></a>     <span class="at">y =</span> irisDF<span class="sc">$</span>Petal.Length[irisDF<span class="sc">$</span>Species<span class="sc">==</span><span class="st">&#39;setosa&#39;</span>],</span>
<span id="cb267-3"><a href="appendix---data-wrangling-and-visualisation.html#cb267-3" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="at">pch =</span> <span class="dv">20</span>,</span>
<span id="cb267-4"><a href="appendix---data-wrangling-and-visualisation.html#cb267-4" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">2.5</span>),</span>
<span id="cb267-5"><a href="appendix---data-wrangling-and-visualisation.html#cb267-5" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">7</span>),</span>
<span id="cb267-6"><a href="appendix---data-wrangling-and-visualisation.html#cb267-6" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&#39;Petal width&#39;</span>,</span>
<span id="cb267-7"><a href="appendix---data-wrangling-and-visualisation.html#cb267-7" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&#39;Petal length&#39;</span>)</span>
<span id="cb267-8"><a href="appendix---data-wrangling-and-visualisation.html#cb267-8" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span> irisDF<span class="sc">$</span>Petal.Width[irisDF<span class="sc">$</span>Species<span class="sc">==</span><span class="st">&#39;versicolor&#39;</span>], </span>
<span id="cb267-9"><a href="appendix---data-wrangling-and-visualisation.html#cb267-9" tabindex="-1"></a>       <span class="at">y =</span> irisDF<span class="sc">$</span>Petal.Length[irisDF<span class="sc">$</span>Species<span class="sc">==</span><span class="st">&#39;versicolor&#39;</span>],</span>
<span id="cb267-10"><a href="appendix---data-wrangling-and-visualisation.html#cb267-10" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb267-11"><a href="appendix---data-wrangling-and-visualisation.html#cb267-11" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span> irisDF<span class="sc">$</span>Petal.Width[irisDF<span class="sc">$</span>Species<span class="sc">==</span><span class="st">&#39;virginica&#39;</span>], </span>
<span id="cb267-12"><a href="appendix---data-wrangling-and-visualisation.html#cb267-12" tabindex="-1"></a>       <span class="at">y =</span> irisDF<span class="sc">$</span>Petal.Length[irisDF<span class="sc">$</span>Species<span class="sc">==</span><span class="st">&#39;virginica&#39;</span>],</span>
<span id="cb267-13"><a href="appendix---data-wrangling-and-visualisation.html#cb267-13" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&#39;darkgreen&#39;</span>, <span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb267-14"><a href="appendix---data-wrangling-and-visualisation.html#cb267-14" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">7</span>, </span>
<span id="cb267-15"><a href="appendix---data-wrangling-and-visualisation.html#cb267-15" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&#39;setosa&#39;</span>, <span class="st">&#39;versicolor&#39;</span>, <span class="st">&#39;virginica&#39;</span>),</span>
<span id="cb267-16"><a href="appendix---data-wrangling-and-visualisation.html#cb267-16" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>,</span>
<span id="cb267-17"><a href="appendix---data-wrangling-and-visualisation.html#cb267-17" tabindex="-1"></a>       <span class="at">col =</span>  <span class="fu">c</span>(<span class="st">&#39;blue&#39;</span>, <span class="st">&#39;red&#39;</span>, <span class="st">&#39;darkgreen&#39;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-178-1.png" style="display: block; margin: auto;" /></p>
<p>Now we can see that there are indeed three clusters and also get a hint that the relationship between petal length and petal width is dependent on species. In the next part of this workshop we will show you how to test this statistically.</p>
<p>Although you can see that we can make highly customised graphs using base R graphics, the steps needed to create the above graph were far from straight forward. So letâs try to do the same using <code>ggplot2</code> instead</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="appendix---data-wrangling-and-visualisation.html#cb268-1" tabindex="-1"></a><span class="fu">ggplot</span>(irisDF, <span class="fu">aes</span>(<span class="at">x =</span> Petal.Width, <span class="at">y =</span> Petal.Length, <span class="at">col =</span> Species)) <span class="sc">+</span></span>
<span id="cb268-2"><a href="appendix---data-wrangling-and-visualisation.html#cb268-2" tabindex="-1"></a>    <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-179-1.png" style="display: block; margin: auto;" /></p>
<p>So essentially with a lone-liner we can create a highly complex graph that required no manual subsetting of the data or manipulation of the plot. We did not have to specify the legend or its position, either; this is all being taken care of by the <code>ggplot2</code> package.</p>
<p>Arguably, for most people <code>ggplot2</code> is not very intuitive to start with and it can take some time to get used to. However, once you have understood the basics, it becomes a very logical and powerful way to create complex and highly customised graphs.</p>
<p>The ethos of <code>ggplot2</code> is that plots can be broken down into different features, most notably:</p>
<ul>
<li><strong>data</strong></li>
<li><strong>aesthetic mapping</strong></li>
<li><strong>geometric object</strong></li>
<li>faceting</li>
<li>scales</li>
<li><em>statistical transformations</em></li>
<li><em>coordinate system</em></li>
<li><em>position adjustments</em></li>
</ul>
<p>The first three are the most most essential ingredients of a plot created with <code>ggplot2</code>. The next one (faceting) is a commonly used method when dealing with categorical data and for creating stratified graphs. The <em>scales</em> feature is useful for translating data values to visual properties and include, for example, log-transforms. The remaining features are only mentioned here but play no further part in this introductory workshop.</p>
<p>In order to explain some of these features is to break the above code apart and add features one-by-one. Letâs start with setting up the plot</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="appendix---data-wrangling-and-visualisation.html#cb269-1" tabindex="-1"></a><span class="fu">ggplot</span>(irisDF)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-180-1.png" style="display: block; margin: auto;" /></p>
<p>Although this creates an empty plot but you will not get an error message - because you have done nothing wrong, you just forgot to add crucial ingredients!</p>
<blockquote>
<p><strong>Note:</strong> In comparison to base R, <code>ggplot2</code> requires a data.frame (or tibble) object for plotting. As shown in the previous section, it is easy to manipulate most other data into an R data frame. We will revisit this at a later stage.</p>
</blockquote>
<div id="aesthetics" class="section level3 unnumbered hasAnchor">
<h3>Aesthetics<a href="appendix---data-wrangling-and-visualisation.html#aesthetics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The next key ingredient is how the data should be mapped onto the visual aesthetics of the plot. This was done through the <code>aes(x = Petal.Width, y = Petal.Length, col = Species)</code> argument to the <code>geom_point()</code> function (see next section). What we do here is x-coordinate to be <code>Petal.Width</code>, the y-coordinates to be <code>Petal.Length</code>, and the colour of the characters to be related to <code>Species</code>. In general, aesthetics include:</p>
<ul>
<li>position</li>
<li>colour / color / col (border or line color)</li>
<li>fill (inside color)</li>
<li>shape</li>
<li>linetype</li>
<li>size.</li>
</ul>
<p>Note that not all aesthetics arguments have to be provided. For example, leaving out the <code>col =</code> argument generates the following graph</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="appendix---data-wrangling-and-visualisation.html#cb270-1" tabindex="-1"></a><span class="fu">ggplot</span>(irisDF, <span class="fu">aes</span>(<span class="at">x =</span> Petal.Width, <span class="at">y =</span> Petal.Length)) <span class="sc">+</span></span>
<span id="cb270-2"><a href="appendix---data-wrangling-and-visualisation.html#cb270-2" tabindex="-1"></a>    <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-181-1.png" style="display: block; margin: auto;" /></p>
</div>
<div id="geoms" class="section level3 unnumbered hasAnchor">
<h3>Geoms<a href="appendix---data-wrangling-and-visualisation.html#geoms" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The next ingredient is the <strong>geom</strong>, which defines the type of plot we want. In the above example we used <code>geom_point()</code>, which produces a scatterplot. Here are the most common geoms:</p>
<ul>
<li><code>geom_point()</code></li>
<li><code>geom_jitter()</code></li>
<li><code>geom_line()</code></li>
<li><code>geom_bar()</code></li>
<li><code>geom_boxplot()</code></li>
<li><code>geom_violin()</code></li>
<li><code>geom_histogram()</code></li>
<li><code>geom_density()</code></li>
</ul>
<p>Letâs try one of them: <code>geom_boxplot</code>. This creates a box-and-whisker plot, that we have already come across. Say for example we are interested in the distribution of sepal lengths but want to stratify this by species.</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="appendix---data-wrangling-and-visualisation.html#cb271-1" tabindex="-1"></a><span class="fu">ggplot</span>(irisDF, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length, <span class="at">fill =</span> Species)) <span class="sc">+</span></span>
<span id="cb271-2"><a href="appendix---data-wrangling-and-visualisation.html#cb271-2" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-182-1.png" style="display: block; margin: auto;" /></p>
<p>Nice! Notice that we did not have to specify the actual x-positioning for the three species; instead, <code>ggplot2</code> recognised that <code>Species</code> was not a numerical variable and treated it internally as a categorical variable (even though we did not specify it as such).</p>
<p>As you will have noticed, <code>ggplot2</code> builds up plots by adding together components. Here we first set up âglobalâ options for the plot using the <code>ggplot()</code> function, where we also specified the plot aesthetics, e.g.Â through <code>aes(x = Petal.Width, y = Petal.Length, col = Species)</code>. We then added (+) to this the type of plot we wanted, e.g.Â <code>geom_point()</code>.
One of the advantages of <code>ggplot2</code> is that it allows us to layer geoms and thus let us built complex graphs in different ways. To demonstrate this, we are going to add the individual data points to the boxplot generated above using the <code>geom_jitter()</code> geom.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="appendix---data-wrangling-and-visualisation.html#cb272-1" tabindex="-1"></a><span class="fu">ggplot</span>(irisDF, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length, <span class="at">fill =</span> Species)) <span class="sc">+</span></span>
<span id="cb272-2"><a href="appendix---data-wrangling-and-visualisation.html#cb272-2" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb272-3"><a href="appendix---data-wrangling-and-visualisation.html#cb272-3" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">height =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-183-1.png" style="display: block; margin: auto;" /></p>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
Three extra arguments were provided to <code>geom_jitter()</code>. By changing their respective values find out what they do?
</div>
</div>
<pre class="(solution)"><code>These arguments control the horizontal spread of the data (width), the vertical &#39;noise&#39; added to each data point and the size of each point </code></pre>
<p><span class="math inline">\(~\)</span></p>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
Change the aesthetics setting such that the colour, and not the fill, are determined by <code>Species</code>. What do you observe?
</div>
</div>
<button id="displayTextunnamed-chunk-186" onclick="javascript:toggle(&#39;unnamed-chunk-186&#39;);">
Show: Solution
</button>
<div id="toggleTextunnamed-chunk-186" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
<pre><code>ggplot(irisDF, aes(x = Species, y = Sepal.Length, col = Species)) +
    geom_boxplot() +
    geom_jitter(width = 0.1, height = 0, size = 0.5)</code></pre>
Specifying the colour aesthetics instead now changes the colour of each data point and the line colour of the boxplots.
</div>
</div>
</div>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="labels" class="section level3 unnumbered hasAnchor">
<h3>Labels<a href="appendix---data-wrangling-and-visualisation.html#labels" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>ggplot2</code> generally does a good job decorating the plot with the right axes labels etc. However, this is still dependent on the variable (i.e.Â column) names, and sometimes we want to add a bit more information or change or even remove labels manually. This can easily done by <em>adding</em> labels in a similar way as adding geoms and other features.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="appendix---data-wrangling-and-visualisation.html#cb275-1" tabindex="-1"></a><span class="fu">ggplot</span>(irisDF, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length, <span class="at">col =</span> Species)) <span class="sc">+</span></span>
<span id="cb275-2"><a href="appendix---data-wrangling-and-visualisation.html#cb275-2" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb275-3"><a href="appendix---data-wrangling-and-visualisation.html#cb275-3" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">height =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb275-4"><a href="appendix---data-wrangling-and-visualisation.html#cb275-4" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;&#39;</span>,  <span class="co"># remove x label</span></span>
<span id="cb275-5"><a href="appendix---data-wrangling-and-visualisation.html#cb275-5" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&#39;Sepal length&#39;</span>,  <span class="co"># set y label</span></span>
<span id="cb275-6"><a href="appendix---data-wrangling-and-visualisation.html#cb275-6" tabindex="-1"></a>         <span class="at">col =</span> <span class="st">&#39;Iris species&#39;</span>, <span class="co"># set legend title)</span></span>
<span id="cb275-7"><a href="appendix---data-wrangling-and-visualisation.html#cb275-7" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">&#39;Distribution of sepal length by species&#39;</span>) <span class="co"># set plot title</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-187-1.png" style="display: block; margin: auto;" /></p>
<p>Note that providing a legend in this case is not strictly necessary. Unfortunately, <code>ggplot</code> adds a legend by default. If you want to remove the legend, you have various options. The two most intuitive ones are</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="appendix---data-wrangling-and-visualisation.html#cb276-1" tabindex="-1"></a><span class="fu">ggplot</span>(irisDF, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length, <span class="at">col =</span> Species)) <span class="sc">+</span></span>
<span id="cb276-2"><a href="appendix---data-wrangling-and-visualisation.html#cb276-2" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb276-3"><a href="appendix---data-wrangling-and-visualisation.html#cb276-3" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">height =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb276-4"><a href="appendix---data-wrangling-and-visualisation.html#cb276-4" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Iris species&#39;</span>,</span>
<span id="cb276-5"><a href="appendix---data-wrangling-and-visualisation.html#cb276-5" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&#39;Sepal length&#39;</span>,</span>
<span id="cb276-6"><a href="appendix---data-wrangling-and-visualisation.html#cb276-6" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">&#39;Distribution of sepal length by species&#39;</span>) <span class="sc">+</span></span>
<span id="cb276-7"><a href="appendix---data-wrangling-and-visualisation.html#cb276-7" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">col =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-188-1.png" style="display: block; margin: auto;" />
or</p>
<pre><code>ggplot(irisDF, aes(x = Species, y = Sepal.Length, col = Species)) +
    geom_boxplot() +
    geom_jitter(width = 0.1, height = 0, size = 0.5) +
    labs(x = &#39;Iris species&#39;,
         y = &#39;Sepal length&#39;,
         title = &#39;Distribution of sepal length by species&#39;) +
    theme(legend.position = &quot;none&quot;)</code></pre>
<p>As a quick aside, notice how we set the arguments in <code>geom_jitter()</code> not as an aesthetics but as a generic option that was applied to all the data. We can use this <em>mixing</em> of aesthetics and generic options to further customise our plot. For example, if we do not wish the individual data points to be coloured by species but simply plotted in black, we can set this as a generic argument</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="appendix---data-wrangling-and-visualisation.html#cb278-1" tabindex="-1"></a><span class="fu">ggplot</span>(irisDF, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length, <span class="at">col =</span> Species)) <span class="sc">+</span></span>
<span id="cb278-2"><a href="appendix---data-wrangling-and-visualisation.html#cb278-2" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb278-3"><a href="appendix---data-wrangling-and-visualisation.html#cb278-3" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">height =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;black&#39;</span>) <span class="sc">+</span></span>
<span id="cb278-4"><a href="appendix---data-wrangling-and-visualisation.html#cb278-4" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Iris species&#39;</span>,</span>
<span id="cb278-5"><a href="appendix---data-wrangling-and-visualisation.html#cb278-5" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&#39;Sepal length&#39;</span>,</span>
<span id="cb278-6"><a href="appendix---data-wrangling-and-visualisation.html#cb278-6" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">&#39;Distribution of sepal length by species&#39;</span>) <span class="sc">+</span></span>
<span id="cb278-7"><a href="appendix---data-wrangling-and-visualisation.html#cb278-7" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-189-1.png" style="display: block; margin: auto;" /></p>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
Produce a density plot for <code>Sepal.Length</code> using <code>geom_density()</code>, which only requires an <code>x</code> aesthetics argument, and fill these in by species. Now add an alpha channel (by adding an argument <code>alpha = ...</code> to the <code>geom_density()</code> function), which controls the opacity of the fill colour, ranging from 0 (complete transparent) to 1 (complete opague).
</div>
</div>
<button id="displayTextunnamed-chunk-191" onclick="javascript:toggle(&#39;unnamed-chunk-191&#39;);">
Show: Solution
</button>
<div id="toggleTextunnamed-chunk-191" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="appendix---data-wrangling-and-visualisation.html#cb279-1" tabindex="-1"></a><span class="fu">ggplot</span>(irisDF, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">fill =</span> Species)) <span class="sc">+</span></span>
<span id="cb279-2"><a href="appendix---data-wrangling-and-visualisation.html#cb279-2" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb279-3"><a href="appendix---data-wrangling-and-visualisation.html#cb279-3" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Sepal length&#39;</span>,</span>
<span id="cb279-4"><a href="appendix---data-wrangling-and-visualisation.html#cb279-4" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&#39;Density&#39;</span>,</span>
<span id="cb279-5"><a href="appendix---data-wrangling-and-visualisation.html#cb279-5" tabindex="-1"></a>         <span class="at">fill =</span> <span class="st">&#39;Iris species&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-525-1.png" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="faceting" class="section level3 unnumbered hasAnchor">
<h3>Faceting<a href="appendix---data-wrangling-and-visualisation.html#faceting" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A very useful feature of <code>ggplot</code> is the ability to use faceting to display sub-plots according to some grouping variable. For example, letâs assume that we want to produce separate scatter plots of petal length vs.Â width for each of the three flower species. We can do this using faceting:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="appendix---data-wrangling-and-visualisation.html#cb280-1" tabindex="-1"></a><span class="fu">ggplot</span>(irisDF, <span class="fu">aes</span>(<span class="at">x =</span> Petal.Width, <span class="at">y =</span> Petal.Length)) <span class="sc">+</span></span>
<span id="cb280-2"><a href="appendix---data-wrangling-and-visualisation.html#cb280-2" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb280-3"><a href="appendix---data-wrangling-and-visualisation.html#cb280-3" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> Species)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-192-1.png" style="display: block; margin: auto;" /></p>
<blockquote>
<p><strong>Note:</strong> there is also the <code>facet_grid()</code> option, which allows you to stratify your data by more than one (categorical) variable.</p>
</blockquote>
<p>As before, we can use the same aesthetics settings as before, which are then applied to each of the facets.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="appendix---data-wrangling-and-visualisation.html#cb281-1" tabindex="-1"></a><span class="fu">ggplot</span>(irisDF, <span class="fu">aes</span>(<span class="at">x =</span> Petal.Width, <span class="at">y =</span> Petal.Length, <span class="at">col =</span> Species)) <span class="sc">+</span></span>
<span id="cb281-2"><a href="appendix---data-wrangling-and-visualisation.html#cb281-2" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb281-3"><a href="appendix---data-wrangling-and-visualisation.html#cb281-3" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> Species) <span class="sc">+</span></span>
<span id="cb281-4"><a href="appendix---data-wrangling-and-visualisation.html#cb281-4" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Petal width&#39;</span>,</span>
<span id="cb281-5"><a href="appendix---data-wrangling-and-visualisation.html#cb281-5" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&#39;Petal length&#39;</span>,</span>
<span id="cb281-6"><a href="appendix---data-wrangling-and-visualisation.html#cb281-6" tabindex="-1"></a>         <span class="at">col =</span> <span class="st">&#39;Iris species&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-193-1.png" style="display: block; margin: auto;" /></p>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
By default, <code>ggplot</code> will use the same x and y limits for each of the facets. This can be overwritten by explicitly setting the <code>scales =</code> argument, which must set to one of âfixedâ (default), âfree_xâ, âfree_yâ, or âfreeâ. Explore what happens when you change this argument.
</div>
</div>
<button id="displayTextunnamed-chunk-195" onclick="javascript:toggle(&#39;unnamed-chunk-195&#39;);">
Show: Solution
</button>
<div id="toggleTextunnamed-chunk-195" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
Setting the <code>scales</code> argument is useful when the data are on very different scales and essentially allows you to <em>zoom in</em>. It is generally considered good practice <em>not</em> to use different scales, however, so always notify the reader in case you change this.
</div>
</div>
</div>
<p><span class="math inline">\(~\)</span></p>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
Use the <code>geom_histogram()</code> function (geom) to produce a histogram plot of <code>Sepal.Width</code> and stratified (faceted) by <code>Species</code>. Explore what happens when you set extra arguments <code>bin = ...</code> (for the number of bins) <em>or</em> <code>binwidth = ...</code> (the width of each bin).
</div>
</div>
<button id="displayTextunnamed-chunk-197" onclick="javascript:toggle(&#39;unnamed-chunk-197&#39;);">
Show: Solution
</button>
<div id="toggleTextunnamed-chunk-197" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="appendix---data-wrangling-and-visualisation.html#cb282-1" tabindex="-1"></a><span class="fu">ggplot</span>(irisDF, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Width, <span class="at">fill =</span> Species)) <span class="sc">+</span></span>
<span id="cb282-2"><a href="appendix---data-wrangling-and-visualisation.html#cb282-2" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb282-3"><a href="appendix---data-wrangling-and-visualisation.html#cb282-3" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> Species)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-537-1.png" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="statistical-transformation" class="section level3 unnumbered hasAnchor">
<h3>Statistical transformation<a href="appendix---data-wrangling-and-visualisation.html#statistical-transformation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A very useful feature of <code>ggplot2</code> is that it allows us to easily add <em>statistical transformations</em> on top of our data. Here we briefly introduce two (related) methods for adding trend lines to a scatterplot via <code>geom_smooth()</code></p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="appendix---data-wrangling-and-visualisation.html#cb283-1" tabindex="-1"></a><span class="fu">ggplot</span>(irisDF, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb283-2"><a href="appendix---data-wrangling-and-visualisation.html#cb283-2" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb283-3"><a href="appendix---data-wrangling-and-visualisation.html#cb283-3" tabindex="-1"></a>    <span class="fu">stat_smooth</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula = &#39;y ~ x&#39;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-198-1.png" style="display: block; margin: auto;" /></p>
<p>By default, <code>geom_smooth()</code> adds a LOESS (<em>locally estimated scatterplot smoothing</em>) smoothed line together with a shaded area that highlights the confidence bounds (which can be turned off by setting <code>se = FALSE</code>.</p>
<p>If we are more interested in a linear trend line, we have to explicitly set the <code>method</code> to <code>lm</code></p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="appendix---data-wrangling-and-visualisation.html#cb285-1" tabindex="-1"></a><span class="fu">ggplot</span>(irisDF, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb285-2"><a href="appendix---data-wrangling-and-visualisation.html#cb285-2" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb285-3"><a href="appendix---data-wrangling-and-visualisation.html#cb285-3" tabindex="-1"></a>    <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>) </span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-199-1.png" style="display: block; margin: auto;" /></p>
<blockquote>
<p><strong>Note:</strong> these trend lines can be added to our plot even if we do not need the scatterplot itself. That is, if, for some reason, you decide you do not want to show the actual data, you can run the above without <code>geom_point()</code> to only show the (linear) trend line.</p>
</blockquote>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
Produce a similar scatterplot as above but not stratified by <code>Species</code> (either faceted or simply coloured in a single graph). What do you observe?
</div>
</div>
<button id="displayTextunnamed-chunk-201" onclick="javascript:toggle(&#39;unnamed-chunk-201&#39;);">
Show: Solution
</button>
<div id="toggleTextunnamed-chunk-201" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="appendix---data-wrangling-and-visualisation.html#cb287-1" tabindex="-1"></a><span class="fu">ggplot</span>(irisDF, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">col =</span> Species)) <span class="sc">+</span></span>
<span id="cb287-2"><a href="appendix---data-wrangling-and-visualisation.html#cb287-2" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb287-3"><a href="appendix---data-wrangling-and-visualisation.html#cb287-3" tabindex="-1"></a>    <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-545-1.png" style="display: block; margin: auto;" /></p>
This is an example of <a href="https://en.wikipedia.org/wiki/Simpson%27s_paradox">Simpsonâs Paradox</a>, where an apparent trend in the data disappears or even reverses (as in our case) when the trend is explored in subsets of the data.
</div>
</div>
</div>
</div>
<div id="scales" class="section level3 unnumbered hasAnchor">
<h3>Scales<a href="appendix---data-wrangling-and-visualisation.html#scales" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Scales control the details of how data values are translated to visual properties and include features such as modifying axes limits and axis transformation. Here we only provide brief example but follow <a href="http://www.sthda.com/english/wiki/ggplot2-axis-scales-and-transformations">this link</a> for a more in-depth tutorial.</p>
<p>To manually set axes limits we can either directly specify which axis we want to modify (e.g.Â through <code>+ xlim(min, max)</code>) or go the more generic way such as</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="appendix---data-wrangling-and-visualisation.html#cb289-1" tabindex="-1"></a><span class="fu">ggplot</span>(irisDF, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb289-2"><a href="appendix---data-wrangling-and-visualisation.html#cb289-2" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb289-3"><a href="appendix---data-wrangling-and-visualisation.html#cb289-3" tabindex="-1"></a>    <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>) <span class="sc">+</span></span>
<span id="cb289-4"><a href="appendix---data-wrangling-and-visualisation.html#cb289-4" tabindex="-1"></a>    <span class="fu">lims</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">3.8</span>, <span class="fl">8.3</span>),</span>
<span id="cb289-5"><a href="appendix---data-wrangling-and-visualisation.html#cb289-5" tabindex="-1"></a>         <span class="at">y =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="dv">5</span>))</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-202-1.png" style="display: block; margin: auto;" /></p>
<p>Much more control and customisation options over limits, axes labels, breaks (i.e.Â tick marks) etc are provided by the <code>scale_xx()</code> functions</p>
<pre><code>scale_x_continuous(name, breaks, labels, limits, trans)
scale_y_continuous(name, breaks, labels, limits, trans)</code></pre>
<p>For more information about these please have a look at the above mentioned tutorial or check R Help through the command <code>?scale_x_continuous</code>.</p>
<p><code>ggplot2</code> offers various inbuilt functions to perform axis transformations, including:</p>
<ul>
<li><code>scale_x_log10()</code>, <code>scale_y_log10()</code> : for log10 transformation</li>
<li><code>scale_x_sqrt()</code>, <code>scale_y_sqrt()</code> : for sqrt transformation</li>
<li><code>scale_x_reverse()</code>, <code>scale_y_reverse()</code> : to reverse coordinates</li>
</ul>
<p>Here is an easy example showing how these can be mixed in a single plot</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="appendix---data-wrangling-and-visualisation.html#cb292-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">10000</span>, <span class="dv">100000</span>),</span>
<span id="cb292-2"><a href="appendix---data-wrangling-and-visualisation.html#cb292-2" tabindex="-1"></a>                 <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">9</span>, <span class="dv">16</span>, <span class="dv">25</span>))</span>
<span id="cb292-3"><a href="appendix---data-wrangling-and-visualisation.html#cb292-3" tabindex="-1"></a></span>
<span id="cb292-4"><a href="appendix---data-wrangling-and-visualisation.html#cb292-4" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb292-5"><a href="appendix---data-wrangling-and-visualisation.html#cb292-5" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb292-6"><a href="appendix---data-wrangling-and-visualisation.html#cb292-6" tabindex="-1"></a>    <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb292-7"><a href="appendix---data-wrangling-and-visualisation.html#cb292-7" tabindex="-1"></a>    <span class="fu">scale_y_sqrt</span>() <span class="sc">+</span></span>
<span id="cb292-8"><a href="appendix---data-wrangling-and-visualisation.html#cb292-8" tabindex="-1"></a>    <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>) </span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-203-1.png" style="display: block; margin: auto;" /></p>
</div>
<div id="assigning-plots-to-objects" class="section level3 unnumbered hasAnchor">
<h3>Assigning plots to objects<a href="appendix---data-wrangling-and-visualisation.html#assigning-plots-to-objects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>So far we have used a separate code block for each plot. One thing to remember is that R is an object oriented language. This means that plots generated with <code>ggplot</code>, for example, can also be assigned as an object. This allows us to add extra layers / features to our plot without rewriting the entire code; here is an example.</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="appendix---data-wrangling-and-visualisation.html#cb294-1" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb294-2"><a href="appendix---data-wrangling-and-visualisation.html#cb294-2" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.4</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)</span>
<span id="cb294-3"><a href="appendix---data-wrangling-and-visualisation.html#cb294-3" tabindex="-1"></a>p1</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-204-1.png" style="display: block; margin: auto;" />
Next we add a line connecting the data points</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="appendix---data-wrangling-and-visualisation.html#cb295-1" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p1 <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>)</span>
<span id="cb295-2"><a href="appendix---data-wrangling-and-visualisation.html#cb295-2" tabindex="-1"></a>p2</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-205-1.png" style="display: block; margin: auto;" /></p>
<p>and finally letâs do some axis transformation</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="appendix---data-wrangling-and-visualisation.html#cb296-1" tabindex="-1"></a>p2 <span class="sc">+</span> <span class="fu">scale_x_log10</span>() <span class="sc">+</span> <span class="fu">scale_y_sqrt</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-206-1.png" style="display: block; margin: auto;" /></p>
</div>
<div id="putting-it-all-together" class="section level3 unnumbered hasAnchor">
<h3>Putting it all together<a href="appendix---data-wrangling-and-visualisation.html#putting-it-all-together" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As a final step we are going to show you how combining different aesthetics and features in <code>ggplot2</code> allows you to make very complex - but both informative and beautiful - graphs. For this we will use a different dataset (<code>LifeExpectancy.csv</code>), start with a simple plot of life expectancy against GDP and then add layers and modifications as we go along.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="appendix---data-wrangling-and-visualisation.html#cb297-1" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb297-2"><a href="appendix---data-wrangling-and-visualisation.html#cb297-2" tabindex="-1"></a>LifeExpectancy <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&#39;LifeExpectancyData.csv&#39;</span>, <span class="at">sep =</span> <span class="st">&#39;,&#39;</span>, <span class="at">header =</span> T)</span>
<span id="cb297-3"><a href="appendix---data-wrangling-and-visualisation.html#cb297-3" tabindex="-1"></a></span>
<span id="cb297-4"><a href="appendix---data-wrangling-and-visualisation.html#cb297-4" tabindex="-1"></a><span class="co"># have a quick glimpse at the data</span></span>
<span id="cb297-5"><a href="appendix---data-wrangling-and-visualisation.html#cb297-5" tabindex="-1"></a><span class="fu">head</span>(LifeExpectancy)</span></code></pre></div>
<pre><code>##       Country Continent Year     Status Life.expectancy Adult.Mortality
## 1 Afghanistan      Asia 2015 Developing            65.0             263
## 2 Afghanistan      Asia 2014 Developing            59.9             271
## 3 Afghanistan      Asia 2013 Developing            59.9             268
## 4 Afghanistan      Asia 2012 Developing            59.5             272
## 5 Afghanistan      Asia 2011 Developing            59.2             275
## 6 Afghanistan      Asia 2010 Developing            58.8             279
##   infant.deaths Alcohol percentage.expenditure Hepatitis.B Measles  BMI
## 1            62    0.01              71.279624          65    1154 19.1
## 2            64    0.01              73.523582          62     492 18.6
## 3            66    0.01              73.219243          64     430 18.1
## 4            69    0.01              78.184215          67    2787 17.6
## 5            71    0.01               7.097109          68    3013 17.2
## 6            74    0.01              79.679367          66    1989 16.7
##   under.five.deaths Polio Total.expenditure Diphtheria HIV.AIDS       GDP
## 1                83     6              8.16         65      0.1 584.25921
## 2                86    58              8.18         62      0.1 612.69651
## 3                89    62              8.13         64      0.1 631.74498
## 4                93    67              8.52         67      0.1 669.95900
## 5                97    68              7.87         68      0.1  63.53723
## 6               102    66              9.20         66      0.1 553.32894
##   Population thinness..1.19.years thinness.5.9.years
## 1   33736494                 17.2               17.3
## 2     327582                 17.5               17.5
## 3   31731688                 17.7               17.7
## 4    3696958                 17.9               18.0
## 5    2978599                 18.2               18.2
## 6    2883167                 18.4               18.4
##   Income.composition.of.resources Schooling
## 1                           0.479      10.1
## 2                           0.476      10.0
## 3                           0.470       9.9
## 4                           0.463       9.8
## 5                           0.454       9.5
## 6                           0.448       9.2</code></pre>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="appendix---data-wrangling-and-visualisation.html#cb299-1" tabindex="-1"></a><span class="co"># subset to only contain data from the year 2000</span></span>
<span id="cb299-2"><a href="appendix---data-wrangling-and-visualisation.html#cb299-2" tabindex="-1"></a>DF <span class="ot">&lt;-</span> LifeExpectancy[LifeExpectancy<span class="sc">$</span>Year <span class="sc">==</span> <span class="dv">2000</span>,]</span>
<span id="cb299-3"><a href="appendix---data-wrangling-and-visualisation.html#cb299-3" tabindex="-1"></a></span>
<span id="cb299-4"><a href="appendix---data-wrangling-and-visualisation.html#cb299-4" tabindex="-1"></a><span class="co"># scatterplot of life expectancy against GDP</span></span>
<span id="cb299-5"><a href="appendix---data-wrangling-and-visualisation.html#cb299-5" tabindex="-1"></a><span class="fu">ggplot</span>(DF, <span class="fu">aes</span>(<span class="at">x =</span> GDP, <span class="at">y =</span> Life.expectancy)) <span class="sc">+</span></span>
<span id="cb299-6"><a href="appendix---data-wrangling-and-visualisation.html#cb299-6" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb299-7"><a href="appendix---data-wrangling-and-visualisation.html#cb299-7" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&#39;Life expectancy (years)&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-207-1.png" style="display: block; margin: auto;" />
&gt; Note: you might get a warning about rows being removed due to missing value. We will get on to this in the next section. For now you can just ignore this.</p>
<p>We can see a clear relationship between life expectancy and GDP. Next we want to see if there is a difference by status of a country (<em>developed</em> or <em>developing</em>)</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="appendix---data-wrangling-and-visualisation.html#cb300-1" tabindex="-1"></a><span class="co"># scatterplot of life expectancy against GDP</span></span>
<span id="cb300-2"><a href="appendix---data-wrangling-and-visualisation.html#cb300-2" tabindex="-1"></a><span class="fu">ggplot</span>(DF, <span class="fu">aes</span>(<span class="at">x =</span> GDP, <span class="at">y =</span> Life.expectancy, <span class="at">col =</span> Status)) <span class="sc">+</span></span>
<span id="cb300-3"><a href="appendix---data-wrangling-and-visualisation.html#cb300-3" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb300-4"><a href="appendix---data-wrangling-and-visualisation.html#cb300-4" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&#39;Life expectancy (years)&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-208-1.png" style="display: block; margin: auto;" />
And again we see a clear patter whereby developed countries appear to have on average a higher life expectancy. Next we can add an additional aesthetics, or stratification, changing the size of each data point according to the respective countryâs population size.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="appendix---data-wrangling-and-visualisation.html#cb301-1" tabindex="-1"></a><span class="co"># scatterplot of life expectancy against GDP</span></span>
<span id="cb301-2"><a href="appendix---data-wrangling-and-visualisation.html#cb301-2" tabindex="-1"></a><span class="fu">ggplot</span>(DF, <span class="fu">aes</span>(<span class="at">x =</span> GDP, <span class="at">y =</span> Life.expectancy, <span class="at">col =</span> Status, <span class="at">size =</span> Population)) <span class="sc">+</span></span>
<span id="cb301-3"><a href="appendix---data-wrangling-and-visualisation.html#cb301-3" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb301-4"><a href="appendix---data-wrangling-and-visualisation.html#cb301-4" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&#39;Life expectancy (years)&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-209-1.png" style="display: block; margin: auto;" />
Although there seems to be a relationship it is hard to see as most countries are squashed into the left-hand side of the graph. To the trained eye it also looks like the GDP data is not normally distributed (which in fact explains the clustering to the left) and we will therefore log-transform the x-axis</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="appendix---data-wrangling-and-visualisation.html#cb302-1" tabindex="-1"></a><span class="co"># scatterplot of life expectancy against GDP</span></span>
<span id="cb302-2"><a href="appendix---data-wrangling-and-visualisation.html#cb302-2" tabindex="-1"></a><span class="fu">ggplot</span>(DF, <span class="fu">aes</span>(<span class="at">x =</span> GDP, <span class="at">y =</span> Life.expectancy, <span class="at">col =</span> Status, <span class="at">size =</span> Population)) <span class="sc">+</span></span>
<span id="cb302-3"><a href="appendix---data-wrangling-and-visualisation.html#cb302-3" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb302-4"><a href="appendix---data-wrangling-and-visualisation.html#cb302-4" tabindex="-1"></a>    <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb302-5"><a href="appendix---data-wrangling-and-visualisation.html#cb302-5" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&#39;Life expectancy (years)&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-210-1.png" style="display: block; margin: auto;" /></p>
<p>Finally, we might be interested to see how life expectancy and its relationship with GDP and the size of the population has evolved over time and across the five continents. Letâs say we want to compare the years 2000, 2005 and 2010.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="appendix---data-wrangling-and-visualisation.html#cb303-1" tabindex="-1"></a><span class="co"># subset data to now contain information for 2000, 2005 and 2010</span></span>
<span id="cb303-2"><a href="appendix---data-wrangling-and-visualisation.html#cb303-2" tabindex="-1"></a>DF <span class="ot">&lt;-</span> LifeExpectancy[LifeExpectancy<span class="sc">$</span>Year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">2005</span>, <span class="dv">2010</span>),]</span>
<span id="cb303-3"><a href="appendix---data-wrangling-and-visualisation.html#cb303-3" tabindex="-1"></a></span>
<span id="cb303-4"><a href="appendix---data-wrangling-and-visualisation.html#cb303-4" tabindex="-1"></a><span class="fu">ggplot</span>(DF, <span class="fu">aes</span>(<span class="at">x =</span> GDP, <span class="at">y =</span> Life.expectancy, <span class="at">col =</span> Status, <span class="at">size =</span> Population)) <span class="sc">+</span></span>
<span id="cb303-5"><a href="appendix---data-wrangling-and-visualisation.html#cb303-5" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb303-6"><a href="appendix---data-wrangling-and-visualisation.html#cb303-6" tabindex="-1"></a>    <span class="fu">facet_grid</span>(Continent <span class="sc">~</span> Year) <span class="sc">+</span></span>
<span id="cb303-7"><a href="appendix---data-wrangling-and-visualisation.html#cb303-7" tabindex="-1"></a>    <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb303-8"><a href="appendix---data-wrangling-and-visualisation.html#cb303-8" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&#39;top&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-211-1.png" style="display: block; margin: auto;" />
NICE!</p>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
Explore the <code>LifeExpectancy</code> dataset using the different features that <code>ggplot</code> has to offer. Can you find any interesting relationships in the data? If so, take note and revist them when we are entering the statistics part of this workshop.
</div>
</div>

</div>
</div>
<div id="data-wrangling" class="section level2 unnumbered hasAnchor">
<h2>Data wrangling<a href="appendix---data-wrangling-and-visualisation.html#data-wrangling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><em>Data wrangling</em>, or the process of cleaning and manipulating data for subsequent analysis, is a key component of modern statistical science and is becoming more important in the age of big (e.g.Â <em>high throughput</em>) data. The <code>tidyverse</code> incorporates a suite of packages, such as <code>tidyr</code> and <code>dplyr</code> that are designed to make common data wrangling tasks not only easier to achieve, but also easier to decipher. Readability of the code is at the core of the philosophy underpinning these packages.</p>
<blockquote>
<p>As always, there are plenty of resources to find useful information about the various data handling functions in the different <code>tidyverse</code> packages, including the <a href="https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf">Data Import Cheat Sheet</a> and <a href="https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf">Data Transformation Cheat Sheet</a>.</p>
</blockquote>
<p>If you havenât done so already, we first need to load the <code>tidyverse</code> library as well as the life expectancy dataset we introduced earlier.</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="appendix---data-wrangling-and-visualisation.html#cb304-1" tabindex="-1"></a><span class="co"># load tidyverse</span></span>
<span id="cb304-2"><a href="appendix---data-wrangling-and-visualisation.html#cb304-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb304-3"><a href="appendix---data-wrangling-and-visualisation.html#cb304-3" tabindex="-1"></a></span>
<span id="cb304-4"><a href="appendix---data-wrangling-and-visualisation.html#cb304-4" tabindex="-1"></a><span class="co"># load dataset andassign to object LifeExp</span></span>
<span id="cb304-5"><a href="appendix---data-wrangling-and-visualisation.html#cb304-5" tabindex="-1"></a>LifeExp <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&#39;LifeExpectancyData.csv&#39;</span>, <span class="at">sep =</span> <span class="st">&#39;,&#39;</span>, <span class="at">header =</span> T)</span></code></pre></div>
<div id="tidy-data" class="section level3 unnumbered hasAnchor">
<h3>Tidy data<a href="appendix---data-wrangling-and-visualisation.html#tidy-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The architect behind the tidyverse, Hadley Wickham, distinguishes between two types of data set: <em>tidy</em> and <em>messy</em>. Rather than being pejorative towards different ways in which people store and visualise data, the point here is to make a distinction between a specific way of arranging data that is useful to most R analyses, and anything else. In fact Hadley has a neat analogy to a famous Tolstoy quote:</p>
<blockquote>
<p>âTidy datasets are all alike but every messy dataset is messy in its own way.â â Hadley Wickham</p>
</blockquote>
<p>In this context, a tidy data set is one in which:</p>
<ul>
<li>rows contain different observations</li>
<li>columns contain different variables</li>
<li>cells contain values</li>
</ul>
<p>Letâs look at a simple example using the life expectancy data.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="appendix---data-wrangling-and-visualisation.html#cb305-1" tabindex="-1"></a><span class="fu">head</span>(LifeExp)</span></code></pre></div>
<pre><code>##       Country Continent Year     Status Life.expectancy Adult.Mortality
## 1 Afghanistan      Asia 2015 Developing            65.0             263
## 2 Afghanistan      Asia 2014 Developing            59.9             271
## 3 Afghanistan      Asia 2013 Developing            59.9             268
## 4 Afghanistan      Asia 2012 Developing            59.5             272
## 5 Afghanistan      Asia 2011 Developing            59.2             275
## 6 Afghanistan      Asia 2010 Developing            58.8             279
##   infant.deaths Alcohol percentage.expenditure Hepatitis.B Measles  BMI
## 1            62    0.01              71.279624          65    1154 19.1
## 2            64    0.01              73.523582          62     492 18.6
## 3            66    0.01              73.219243          64     430 18.1
## 4            69    0.01              78.184215          67    2787 17.6
## 5            71    0.01               7.097109          68    3013 17.2
## 6            74    0.01              79.679367          66    1989 16.7
##   under.five.deaths Polio Total.expenditure Diphtheria HIV.AIDS       GDP
## 1                83     6              8.16         65      0.1 584.25921
## 2                86    58              8.18         62      0.1 612.69651
## 3                89    62              8.13         64      0.1 631.74498
## 4                93    67              8.52         67      0.1 669.95900
## 5                97    68              7.87         68      0.1  63.53723
## 6               102    66              9.20         66      0.1 553.32894
##   Population thinness..1.19.years thinness.5.9.years
## 1   33736494                 17.2               17.3
## 2     327582                 17.5               17.5
## 3   31731688                 17.7               17.7
## 4    3696958                 17.9               18.0
## 5    2978599                 18.2               18.2
## 6    2883167                 18.4               18.4
##   Income.composition.of.resources Schooling
## 1                           0.479      10.1
## 2                           0.476      10.0
## 3                           0.470       9.9
## 4                           0.463       9.8
## 5                           0.454       9.5
## 6                           0.448       9.2</code></pre>
<div class="panel panel-default">
<div class="panel-heading">
Question
</div>
<div class="panel-body">
Is this data <em>tidy</em>?
</div>
</div>
<button id="displayTextunnamed-chunk-216" onclick="javascript:toggle(&#39;unnamed-chunk-216&#39;);">
Show: Solution
</button>
<div id="toggleTextunnamed-chunk-216" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
Yes, because each row corresponds to a single observation, each column corresponds to a single variable and each cell contains a value.
</div>
</div>
</div>
<p><span class="math inline">\(~\)</span></p>
<p>In this workshop we will see various ways in which datasets can be manipulated to and from the <em>tidy</em> format.</p>
</div>
<div id="filter-rows" class="section level3 unnumbered hasAnchor">
<h3>Filter rows<a href="appendix---data-wrangling-and-visualisation.html#filter-rows" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The first data manipulation we could do is to filter the data, as we have done earlier when plotting the data only for the year 2000. In base R this worked as</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="appendix---data-wrangling-and-visualisation.html#cb307-1" tabindex="-1"></a>LifeExp[LifeExp<span class="sc">$</span>Year <span class="sc">==</span> <span class="dv">2000</span>,]</span></code></pre></div>
<p>To do the equivalent in <code>tidyverse</code>, we use the <code>filter()</code> function</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="appendix---data-wrangling-and-visualisation.html#cb308-1" tabindex="-1"></a><span class="fu">filter</span>(LifeExp, Year <span class="sc">==</span> <span class="dv">2000</span>)</span></code></pre></div>
<p>Note, one of the most distinctive / useful feature of <code>tidyverse</code> (or rather <code>migrittr</code>, which <code>tidyverse</code>/<code>dplyr</code> depends on) is the so-called piping operator, denoted as <code>%&gt;%</code>. This operator allows you to <em>chain</em> one function after another without relying on nested parentheses or having to assign / store intermediate objects. So what it is doing is evaluating the expression on the right-hand side (or next line) of the <code>%&gt;%</code> (pipe) using the expression on the left (or same line) as the first argument. If this sounds confusing then fear not - all will be made clearer once you see it in action! Using the same example as above we can get the same results with piping</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="appendix---data-wrangling-and-visualisation.html#cb309-1" tabindex="-1"></a>LifeExp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2000</span>)</span></code></pre></div>
<p>Initially this might look more complicated but you will soon see how this is a very useful operator indeed.</p>
</div>
<div id="sort-rows" class="section level3 unnumbered hasAnchor">
<h3>Sort rows<a href="appendix---data-wrangling-and-visualisation.html#sort-rows" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Another common operation is to sort rows according to some criterion. For example, we might wish to sort our data by <code>Status</code> and then <code>Life.expectancy</code>. In tidyverse this is done using the <code>arrange()</code> function.</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="appendix---data-wrangling-and-visualisation.html#cb310-1" tabindex="-1"></a><span class="fu">arrange</span>(LifeExp, Status, Life.expectancy)</span></code></pre></div>
<p>or using the piping operator</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="appendix---data-wrangling-and-visualisation.html#cb311-1" tabindex="-1"></a>LifeExp <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Status, Life.expectancy)</span></code></pre></div>
</div>
<div id="select-columns" class="section level3 unnumbered hasAnchor">
<h3>Select columns<a href="appendix---data-wrangling-and-visualisation.html#select-columns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The next common operation is the selection of columns, which also includes <em>de</em>selection of particular columns. Letâs say we are interested only in the countries and their corresponding life expectancy, GDP, population size and the year of sampling. Before showing you how this can efficiently done in <code>tidyverse</code>, here are some options of how to achieve this in base R</p>
<pre><code>## option 1
LifeExp[, match(c(&quot;Country&quot;, &quot;Life.expectancy&quot;, &quot;GDP&quot;, &quot;Population&quot;), colnames(LifeExp))]

## option 2
cbind(Country = LifeExp$Country, Life.expectancy = LifeExp$Life.expectancy, 
      GDP = LifeExp$GDP, Population = LifeExp$Population)

## option 3 (requires knowing which columns are which)
LifeExp[, c(1, 4, 16, 17)]</code></pre>
<p>And here is how easy and hopefully by now intuitively this can be done using the <code>select()</code> function</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="appendix---data-wrangling-and-visualisation.html#cb313-1" tabindex="-1"></a>LifeExp <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country, Continent, Life.expectancy, GDP, Population) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##       Country Continent Life.expectancy       GDP Population
## 1 Afghanistan      Asia            65.0 584.25921   33736494
## 2 Afghanistan      Asia            59.9 612.69651     327582
## 3 Afghanistan      Asia            59.9 631.74498   31731688
## 4 Afghanistan      Asia            59.5 669.95900    3696958
## 5 Afghanistan      Asia            59.2  63.53723    2978599
## 6 Afghanistan      Asia            58.8 553.32894    2883167</code></pre>
<blockquote>
<p><strong>Note:</strong> notice that we added one extra pipe at the end <code>%&gt;% head(.)</code>. Remember that the <code>head()</code> function displays the first few rows of a data.frame. What we are doing here is that we first take the data.frame <code>LifeExp</code>, the apply the <code>filter()</code> function and then use the results of this as the argument in <code>head()</code></p>
</blockquote>
<p>De-selection, or filtering out particular columns follows a similar structure but in this case the column to be removed is preceded by a â-â; for example</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="appendix---data-wrangling-and-visualisation.html#cb315-1" tabindex="-1"></a>LifeExp <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Adult.Mortality) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<p>As you will have noticed, we can easy combine various data manipulation functions using pipes without having to store any intermediate results or use excessive parenthesis. Letâs try this out</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="appendix---data-wrangling-and-visualisation.html#cb316-1" tabindex="-1"></a>LifeExp <span class="sc">%&gt;%</span> </span>
<span id="cb316-2"><a href="appendix---data-wrangling-and-visualisation.html#cb316-2" tabindex="-1"></a>    <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb316-3"><a href="appendix---data-wrangling-and-visualisation.html#cb316-3" tabindex="-1"></a>    <span class="fu">select</span>(Country, Continent, Life.expectancy, GDP, Population) <span class="sc">%&gt;%</span></span>
<span id="cb316-4"><a href="appendix---data-wrangling-and-visualisation.html#cb316-4" tabindex="-1"></a>    <span class="fu">arrange</span>(Life.expectancy) <span class="sc">%&gt;%</span></span>
<span id="cb316-5"><a href="appendix---data-wrangling-and-visualisation.html#cb316-5" tabindex="-1"></a>    <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##                     Country Continent Life.expectancy       GDP Population
## 1              Sierra Leone    Africa            39.0 139.31477    4564297
## 2                    Malawi    Africa            43.1 153.25949   11376172
## 3                    Zambia    Africa            43.8 341.95562    1531221
## 4                    Angola    Africa            45.3 555.29694    1644924
## 5                   Eritrea    Africa            45.3  28.19695     339281
## 6  Central African Republic    Africa            46.0 243.54293    3754986
## 7                  Zimbabwe    Africa            46.0 547.35888   12222251
## 8                    Uganda    Africa            46.6 257.63369    2439274
## 9                   Nigeria    Africa            47.1 379.11933    1223529
## 10                     Chad    Africa            47.6 166.23179    8342559</code></pre>
<p>Powerful stuff!</p>
</div>
<div id="grouping-and-summarising" class="section level3 unnumbered hasAnchor">
<h3>Grouping and summarising<a href="appendix---data-wrangling-and-visualisation.html#grouping-and-summarising" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A common thing we might want to do is to produce summaries of some variable for different subsets of the data. For example, we might want to produce an estimate of the mean life expectancy for for each year. The <code>dplyr</code> package provides a function <code>group_by()</code>, which allows us to group data by one or more variables, and the <code>summarise()</code>, which allows us to summarise data. These can be used in combination get stratified summaries as shown here</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="appendix---data-wrangling-and-visualisation.html#cb318-1" tabindex="-1"></a>LifeExp <span class="sc">%&gt;%</span> </span>
<span id="cb318-2"><a href="appendix---data-wrangling-and-visualisation.html#cb318-2" tabindex="-1"></a>    <span class="fu">group_by</span>(Year) <span class="sc">%&gt;%</span></span>
<span id="cb318-3"><a href="appendix---data-wrangling-and-visualisation.html#cb318-3" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mn =</span> <span class="fu">mean</span>(Life.expectancy))</span></code></pre></div>
<pre><code>## # A tibble: 16 Ã 2
##     Year    mn
##    &lt;int&gt; &lt;dbl&gt;
##  1  2000  65.9
##  2  2001  66.2
##  3  2002  66.5
##  4  2003  66.5
##  5  2004  66.9
##  6  2005  67.5
##  7  2006  68.0
##  8  2007  68.5
##  9  2008  68.9
## 10  2009  69.3
## 11  2010  69.4
## 12  2011  70.1
## 13  2012  70.5
## 14  2013  70.9
## 15  2014  71.1
## 16  2015  71.2</code></pre>
<p>The most commonly functions used for summarising data are</p>
<ul>
<li>Center: <code>mean()</code>, <code>median()</code></li>
<li>Spread: <code>sd()</code>, <code>IQR()</code></li>
<li>Range: <code>min()</code>, <code>max()</code>,</li>
<li>Count: <code>n()</code></li>
</ul>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
<p>Test your skills by</p>
<ol style="list-style-type: decimal">
<li>calculating the mean life expectancy by continent</li>
<li>calculating the mean life expectancy by continent and year</li>
<li>calculating the mean and median of the GDP for each continent in the years 2000, 2005 and 2010</li>
</ol>
(note, for both the <code>mean()</code> and <code>median()</code> we have to add an extra argument <code>na.rm = TRUE</code> - what happens if we donât?)
</div>
</div>
<button id="displayTextunnamed-chunk-227" onclick="javascript:toggle(&#39;unnamed-chunk-227&#39;);">
Show: Solution
</button>
<div id="toggleTextunnamed-chunk-227" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
<ol style="list-style-type: decimal">
<li>calculating the mean life expectancy by continent</li>
</ol>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="appendix---data-wrangling-and-visualisation.html#cb320-1" tabindex="-1"></a>LifeExp <span class="sc">%&gt;%</span> </span>
<span id="cb320-2"><a href="appendix---data-wrangling-and-visualisation.html#cb320-2" tabindex="-1"></a>    <span class="fu">group_by</span>(Continent, Year) <span class="sc">%&gt;%</span></span>
<span id="cb320-3"><a href="appendix---data-wrangling-and-visualisation.html#cb320-3" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mn =</span> <span class="fu">mean</span>(Life.expectancy))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;Continent&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 80 Ã 3
## # Groups:   Continent [5]
##    Continent  Year    mn
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt;
##  1 Africa     2000  54.5
##  2 Africa     2001  55.0
##  3 Africa     2002  55.3
##  4 Africa     2003  55.0
##  5 Africa     2004  55.7
##  6 Africa     2005  57.0
##  7 Africa     2006  57.2
##  8 Africa     2007  57.9
##  9 Africa     2008  58.8
## 10 Africa     2009  59.6
## # â¹ 70 more rows</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>calculating the mean life expectancy by continent and year</li>
</ol>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="appendix---data-wrangling-and-visualisation.html#cb323-1" tabindex="-1"></a>LifeExp <span class="sc">%&gt;%</span> </span>
<span id="cb323-2"><a href="appendix---data-wrangling-and-visualisation.html#cb323-2" tabindex="-1"></a>    <span class="fu">group_by</span>(Continent) <span class="sc">%&gt;%</span></span>
<span id="cb323-3"><a href="appendix---data-wrangling-and-visualisation.html#cb323-3" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mn =</span> <span class="fu">mean</span>(Life.expectancy))</span></code></pre></div>
<pre><code>## # A tibble: 5 Ã 2
##   Continent    mn
##   &lt;chr&gt;     &lt;dbl&gt;
## 1 Africa     58.4
## 2 Americas   74.1
## 3 Asia       71.2
## 4 Europe     78.8
## 5 Oceania    81.6</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>calculating the mean and median of the GDP for each continent in the years 2000, 2005 and 2010</li>
</ol>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="appendix---data-wrangling-and-visualisation.html#cb325-1" tabindex="-1"></a>LifeExp <span class="sc">%&gt;%</span> </span>
<span id="cb325-2"><a href="appendix---data-wrangling-and-visualisation.html#cb325-2" tabindex="-1"></a>    <span class="fu">filter</span>(Year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">2005</span>, <span class="dv">2010</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb325-3"><a href="appendix---data-wrangling-and-visualisation.html#cb325-3" tabindex="-1"></a>    <span class="fu">group_by</span>(Year) <span class="sc">%&gt;%</span></span>
<span id="cb325-4"><a href="appendix---data-wrangling-and-visualisation.html#cb325-4" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">GDP_mn =</span> <span class="fu">mean</span>(GDP, <span class="at">na.rm =</span> T),</span>
<span id="cb325-5"><a href="appendix---data-wrangling-and-visualisation.html#cb325-5" tabindex="-1"></a>              <span class="at">GDP_md =</span> <span class="fu">median</span>(GDP, <span class="at">na.rm =</span> T))</span></code></pre></div>
<pre><code>## # A tibble: 3 Ã 3
##    Year GDP_mn GDP_md
##   &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1  2000  4847.   658.
## 2  2005  7562.  1286.
## 3  2010  8386.  1931.</code></pre>
</div>
</div>
</div>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="reshaping-datasets" class="section level3 unnumbered hasAnchor">
<h3>Reshaping datasets<a href="appendix---data-wrangling-and-visualisation.html#reshaping-datasets" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Recall, a key philosophy of <code>tidyverse</code> is the notion of data being <em>tidy</em>. In fact, to get the most out of <code>ggplot</code>, datasets need to be in a specific format. More often than not, though, you will be dealing with <em>untidy</em> data. To give you an example, letâs have a look at the data file <code>ExposureIndex.csv</code>, which contains the recorded malaria exposure index for 103 individuals in Junju, Kenya, between the years 2000 and 2010.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="appendix---data-wrangling-and-visualisation.html#cb327-1" tabindex="-1"></a>EI <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;ExposureIndex.csv&#39;</span>, <span class="at">check.names =</span> F)  <span class="co"># the argument check.names=F prevents renaming of col names</span></span>
<span id="cb327-2"><a href="appendix---data-wrangling-and-visualisation.html#cb327-2" tabindex="-1"></a><span class="fu">head</span>(EI)</span></code></pre></div>
<pre><code>##   Participant.ID      2000      2001         2002      2003         2004
## 1          N0004 0.7500000 0.5666667 4.705882e-01 0.4736842 1.578947e-01
## 2          N0007 0.9090909 0.6923077 3.333333e-01 0.1666667 9.770000e-15
## 3          N0016 0.7500000 0.8750000 3.750000e-01 0.6250000 1.000000e+00
## 4          N0024 0.7500000 0.5333333 5.294117e-01 0.4210526 1.052632e-01
## 5          N0041 0.5000000 0.3888889 8.690000e-13 0.3333333 6.400000e-13
## 6          N0055 0.7500000 0.5333333 5.294117e-01 0.4210526 1.578947e-01
##       2005     2006     2007 2008     2009     2010
## 1 0.00e+00 0.00e+00 8.70e-14    0 5.00e-02 1.00e-01
## 2 1.27e-14 9.77e-15 0.00e+00    0 0.00e+00 2.44e-14
## 3 5.00e-01 0.00e+00 2.00e-01    0 2.16e-14 3.60e-15
## 4 0.00e+00 0.00e+00 8.70e-14    0 5.00e-02 1.00e-01
## 5 1.56e-13 0.00e+00 4.25e-13    0 3.45e-13 5.74e-14
## 6 0.00e+00 0.00e+00 8.70e-14    0 5.00e-02 1.00e-01</code></pre>
<div class="panel panel-default">
<div class="panel-heading">
Question
</div>
<div class="panel-body">
Is this data in <em>tidy</em> format? And if not, why not?
</div>
</div>
<button id="displayTextunnamed-chunk-230" onclick="javascript:toggle(&#39;unnamed-chunk-230&#39;);">
Show: Solution
</button>
<div id="toggleTextunnamed-chunk-230" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
No, this data is not in <em>tidyâ format. We can see that each row corresponds to a different participant, but each column corresponds to a different year. For this to be </em>tidy*, we would need one column containing the participant, one column containing the year, and a third column containing the exposure index for participant in each year.
</div>
</div>
</div>
<p><span class="math inline">\(~\)</span></p>
<p>Luckily, within <code>tidyverse</code> is it easy to <em>reshape</em> data to get it into the desired format. In this case we want to reshape it from a <em>wide format</em> into a <em>long format</em>. The necessary function to do this is called <code>gather()</code>, which takes two or more columns and gathers them into key-value pairs (here: year - exposure index). The columns to gather are <code>2000</code>, <code>2001</code>, â¦, <code>2010</code>, which we can shorten to <code>2000:2010</code> (i.e.Â all columns from <code>2000</code> to <code>2010</code>)</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="appendix---data-wrangling-and-visualisation.html#cb329-1" tabindex="-1"></a>EI_long <span class="ot">&lt;-</span> EI <span class="sc">%&gt;%</span></span>
<span id="cb329-2"><a href="appendix---data-wrangling-and-visualisation.html#cb329-2" tabindex="-1"></a>    <span class="fu">gather</span>(Year, ExposureIndex, <span class="st">&#39;2000&#39;</span><span class="sc">:</span><span class="st">&#39;2010&#39;</span>) </span>
<span id="cb329-3"><a href="appendix---data-wrangling-and-visualisation.html#cb329-3" tabindex="-1"></a></span>
<span id="cb329-4"><a href="appendix---data-wrangling-and-visualisation.html#cb329-4" tabindex="-1"></a><span class="fu">head</span>(EI_long, <span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##    Participant.ID Year ExposureIndex
## 1           N0004 2000     0.7500000
## 2           N0007 2000     0.9090909
## 3           N0016 2000     0.7500000
## 4           N0024 2000     0.7500000
## 5           N0041 2000     0.5000000
## 6           N0055 2000     0.7500000
## 7           N0059 2000     0.7500000
## 8           N0067 2000     0.7500000
## 9           N0089 2000     0.4375000
## 10          N0096 2000     0.4375000</code></pre>
<blockquote>
<p><strong>Note:</strong> because the column names were numerical values and not strings, we have to encase them by â â. This is not necessary if column names are in character format.</p>
</blockquote>
<p>The converse of <code>gather()</code> is <code>spread()</code>, which takes two columns (<code>key</code> and <code>value</code>) and spreads them into multiple columns (dictated by the number of unique <code>values</code>).</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="appendix---data-wrangling-and-visualisation.html#cb331-1" tabindex="-1"></a>EI_long <span class="sc">%&gt;%</span></span>
<span id="cb331-2"><a href="appendix---data-wrangling-and-visualisation.html#cb331-2" tabindex="-1"></a>    <span class="fu">spread</span>(Year, ExposureIndex) <span class="sc">%&gt;%</span></span>
<span id="cb331-3"><a href="appendix---data-wrangling-and-visualisation.html#cb331-3" tabindex="-1"></a>    <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##   Participant.ID      2000      2001         2002      2003         2004
## 1          N0004 0.7500000 0.5666667 4.705882e-01 0.4736842 1.578947e-01
## 2          N0007 0.9090909 0.6923077 3.333333e-01 0.1666667 9.770000e-15
## 3          N0016 0.7500000 0.8750000 3.750000e-01 0.6250000 1.000000e+00
## 4          N0024 0.7500000 0.5333333 5.294117e-01 0.4210526 1.052632e-01
## 5          N0041 0.5000000 0.3888889 8.690000e-13 0.3333333 6.400000e-13
## 6          N0055 0.7500000 0.5333333 5.294117e-01 0.4210526 1.578947e-01
##       2005     2006     2007 2008     2009     2010
## 1 0.00e+00 0.00e+00 8.70e-14    0 5.00e-02 1.00e-01
## 2 1.27e-14 9.77e-15 0.00e+00    0 0.00e+00 2.44e-14
## 3 5.00e-01 0.00e+00 2.00e-01    0 2.16e-14 3.60e-15
## 4 0.00e+00 0.00e+00 8.70e-14    0 5.00e-02 1.00e-01
## 5 1.56e-13 0.00e+00 4.25e-13    0 3.45e-13 5.74e-14
## 6 0.00e+00 0.00e+00 8.70e-14    0 5.00e-02 1.00e-01</code></pre>
</div>
<div id="mutate" class="section level3 unnumbered hasAnchor">
<h3>Mutate<a href="appendix---data-wrangling-and-visualisation.html#mutate" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Last but not least we show you how to create, modify or even delete columns with <code>mutate()</code>. In fact, <code>mutate()</code> is probably one of the functions you will end up using the most. However, the functionality of <code>mutate()</code> is introduced here by means of two examples, which also introduce a few other useful features.</p>
<p>In the first example we are going to create a new column in our data.frame <code>EI_long</code>, where we categorise the exposure index into <em>high</em> and <em>low</em> depending on its value being above or below 0.5, respectively. One new function we are going to introduce is <code>ifelse()</code>; please use the help for more details, although its use should become apparent.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="appendix---data-wrangling-and-visualisation.html#cb333-1" tabindex="-1"></a>EI_long <span class="ot">&lt;-</span> EI_long <span class="sc">%&gt;%</span></span>
<span id="cb333-2"><a href="appendix---data-wrangling-and-visualisation.html#cb333-2" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">EI_cat =</span> <span class="fu">ifelse</span>(ExposureIndex <span class="sc">&gt;=</span> <span class="fl">0.5</span>, <span class="st">&#39;high&#39;</span>, <span class="st">&#39;low&#39;</span>))</span>
<span id="cb333-3"><a href="appendix---data-wrangling-and-visualisation.html#cb333-3" tabindex="-1"></a></span>
<span id="cb333-4"><a href="appendix---data-wrangling-and-visualisation.html#cb333-4" tabindex="-1"></a><span class="fu">head</span>(EI_long, <span class="at">n=</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>##    Participant.ID Year ExposureIndex EI_cat
## 1           N0004 2000     0.7500000   high
## 2           N0007 2000     0.9090909   high
## 3           N0016 2000     0.7500000   high
## 4           N0024 2000     0.7500000   high
## 5           N0041 2000     0.5000000   high
## 6           N0055 2000     0.7500000   high
## 7           N0059 2000     0.7500000   high
## 8           N0067 2000     0.7500000   high
## 9           N0089 2000     0.4375000    low
## 10          N0096 2000     0.4375000    low</code></pre>
<p>In the second example we going to use <code>mutate()</code> to modify three existing columns. First, we are going to round the <code>ExposureIndex</code> to two significant digits; then we are turning our new column <code>EI_cat</code> into a categorical variable using the function <code>factor()</code>; and finally we are going to change the <code>Year</code> column into a numeric format</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="appendix---data-wrangling-and-visualisation.html#cb335-1" tabindex="-1"></a>EI_long <span class="ot">&lt;-</span> EI_long <span class="sc">%&gt;%</span></span>
<span id="cb335-2"><a href="appendix---data-wrangling-and-visualisation.html#cb335-2" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ExposureIndex =</span> <span class="fu">round</span>(ExposureIndex, <span class="at">digits=</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb335-3"><a href="appendix---data-wrangling-and-visualisation.html#cb335-3" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">EI_cat =</span> <span class="fu">factor</span>(EI_cat)) <span class="sc">%&gt;%</span></span>
<span id="cb335-4"><a href="appendix---data-wrangling-and-visualisation.html#cb335-4" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.numeric</span>(Year))</span>
<span id="cb335-5"><a href="appendix---data-wrangling-and-visualisation.html#cb335-5" tabindex="-1"></a></span>
<span id="cb335-6"><a href="appendix---data-wrangling-and-visualisation.html#cb335-6" tabindex="-1"></a><span class="co"># note, we could have done the same in a single mutate() call</span></span>
<span id="cb335-7"><a href="appendix---data-wrangling-and-visualisation.html#cb335-7" tabindex="-1"></a><span class="co"># EI_long &lt;- EI_long %&gt;%</span></span>
<span id="cb335-8"><a href="appendix---data-wrangling-and-visualisation.html#cb335-8" tabindex="-1"></a><span class="co">#     mutate(ExposureIndex = round(ExposureIndex, digits=2),</span></span>
<span id="cb335-9"><a href="appendix---data-wrangling-and-visualisation.html#cb335-9" tabindex="-1"></a><span class="co">#            EI_cat = factor(EI_cat),</span></span>
<span id="cb335-10"><a href="appendix---data-wrangling-and-visualisation.html#cb335-10" tabindex="-1"></a><span class="co">#            Year = as.numeric(Year))</span></span>
<span id="cb335-11"><a href="appendix---data-wrangling-and-visualisation.html#cb335-11" tabindex="-1"></a></span>
<span id="cb335-12"><a href="appendix---data-wrangling-and-visualisation.html#cb335-12" tabindex="-1"></a><span class="fu">head</span>(EI_long, <span class="at">n=</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>##    Participant.ID Year ExposureIndex EI_cat
## 1           N0004 2000          0.75   high
## 2           N0007 2000          0.91   high
## 3           N0016 2000          0.75   high
## 4           N0024 2000          0.75   high
## 5           N0041 2000          0.50   high
## 6           N0055 2000          0.75   high
## 7           N0059 2000          0.75   high
## 8           N0067 2000          0.75   high
## 9           N0089 2000          0.44    low
## 10          N0096 2000          0.44    low</code></pre>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
<ol style="list-style-type: decimal">
<li>produce a <code>ggplot</code> line graph of the mean exposure index against time (2000 to 2010)</li>
<li>show the distribution of the expsoure index over time by means of box-and-whisker plots</li>
</ol>
<p><infobutton id="displayTextunnamed-chunk-595" onclick="javascript:toggle('unnamed-chunk-595');">Show: Hint</infobutton></p>
<div id="toggleTextunnamed-chunk-595" style="display: none">
<div class="panel panel-default">
<div class="panel-body">
Hint: the first task involves a combination of <code>group_by()</code> and <code>summarise()</code>, and for the second task you might need to mutate the <code>Year</code> column into a categorical variable. Also, you can do this by either creating a new data.frame for each task, or by using the pipe to send your modified data.frame straight to <code>ggplot</code>, in which case you do not need to specifiy the data in the <code>ggplot()</code> function.
</div>
</div>
</div>
</div>
</div>
<button id="displayTextunnamed-chunk-236" onclick="javascript:toggle(&#39;unnamed-chunk-236&#39;);">
Show: Solution
</button>
<div id="toggleTextunnamed-chunk-236" style="display: none">
<div class="panel panel-default">
<div class="panel-heading panel-heading1">
Solution
</div>
<div class="panel-body">
<ol style="list-style-type: decimal">
<li>a line graph of the mean exposure index against time (2000 to 2010)</li>
</ol>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="appendix---data-wrangling-and-visualisation.html#cb337-1" tabindex="-1"></a>EI_long <span class="sc">%&gt;%</span></span>
<span id="cb337-2"><a href="appendix---data-wrangling-and-visualisation.html#cb337-2" tabindex="-1"></a>    <span class="fu">group_by</span>(Year) <span class="sc">%&gt;%</span></span>
<span id="cb337-3"><a href="appendix---data-wrangling-and-visualisation.html#cb337-3" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">meanEI =</span> <span class="fu">mean</span>(ExposureIndex)) <span class="sc">%&gt;%</span></span>
<span id="cb337-4"><a href="appendix---data-wrangling-and-visualisation.html#cb337-4" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> meanEI)) <span class="sc">+</span></span>
<span id="cb337-5"><a href="appendix---data-wrangling-and-visualisation.html#cb337-5" tabindex="-1"></a>    <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-600-1.png" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>distribution of the expsoure index over time by means of box-and-whisker plots</li>
</ol>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="appendix---data-wrangling-and-visualisation.html#cb338-1" tabindex="-1"></a>EI_long <span class="sc">%&gt;%</span></span>
<span id="cb338-2"><a href="appendix---data-wrangling-and-visualisation.html#cb338-2" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">factor</span>(Year)) <span class="sc">%&gt;%</span></span>
<span id="cb338-3"><a href="appendix---data-wrangling-and-visualisation.html#cb338-3" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> ExposureIndex)) <span class="sc">+</span></span>
<span id="cb338-4"><a href="appendix---data-wrangling-and-visualisation.html#cb338-4" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-601-1.png" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="dealing-with-missing-data" class="section level3 unnumbered hasAnchor">
<h3>Dealing with missing data<a href="appendix---data-wrangling-and-visualisation.html#dealing-with-missing-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One recurring problem with data analysis is that data are often incomplete, leading to more or less serious downstream data analysis problems. That is, different functions deal with missing data in different ways, some simply ignore them whereas others fail completely. We therefore need to expand our data wrangling toolbox.</p>
<p>Missing data in R are usually referred to <code>NA</code>âs, and here is an example of where NAâs can become problematic</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="appendix---data-wrangling-and-visualisation.html#cb339-1" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">9</span>, <span class="cn">NA</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb339-2"><a href="appendix---data-wrangling-and-visualisation.html#cb339-2" tabindex="-1"></a><span class="fu">mean</span>(x)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>There are various ways to deal with missing data, of which we only touch upon a few</p>
<div id="detecting-missing-data" class="section level4 unnumbered hasAnchor">
<h4><strong>Detecting missing data</strong><a href="appendix---data-wrangling-and-visualisation.html#detecting-missing-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The first thing we might want to know if there are any NAâs, and a function for this is <code>is.na()</code>, which works on single variables, vectors, matrices and data.frames</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="appendix---data-wrangling-and-visualisation.html#cb341-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">9</span>, <span class="cn">NA</span>, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb341-2"><a href="appendix---data-wrangling-and-visualisation.html#cb341-2" tabindex="-1"></a>                 <span class="at">y =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="cn">NA</span>, <span class="fl">0.1</span>, <span class="cn">NA</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>))</span>
<span id="cb341-3"><a href="appendix---data-wrangling-and-visualisation.html#cb341-3" tabindex="-1"></a></span>
<span id="cb341-4"><a href="appendix---data-wrangling-and-visualisation.html#cb341-4" tabindex="-1"></a><span class="fu">is.na</span>(df)</span></code></pre></div>
<pre><code>##          x     y
## [1,] FALSE FALSE
## [2,] FALSE FALSE
## [3,] FALSE  TRUE
## [4,] FALSE FALSE
## [5,]  TRUE  TRUE
## [6,] FALSE FALSE
## [7,] FALSE FALSE</code></pre>
</div>
<div id="removing-nas" class="section level4 unnumbered hasAnchor">
<h4><strong>Removing NAâs</strong><a href="appendix---data-wrangling-and-visualisation.html#removing-nas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Going back to our previous example, if we want to calculate the mean of <code>x</code> we can either manually remove the offending entries or tell <code>mean()</code> to ignore them</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="appendix---data-wrangling-and-visualisation.html#cb343-1" tabindex="-1"></a><span class="co"># option 1: tell mean() to ignore NA</span></span>
<span id="cb343-2"><a href="appendix---data-wrangling-and-visualisation.html#cb343-2" tabindex="-1"></a><span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 4.166667</code></pre>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="appendix---data-wrangling-and-visualisation.html#cb345-1" tabindex="-1"></a><span class="co"># option 2: remove NA manually</span></span>
<span id="cb345-2"><a href="appendix---data-wrangling-and-visualisation.html#cb345-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> x[<span class="sc">!</span><span class="fu">is.na</span>(x)]  <span class="co"># this means that x should be assigned to all entries of x that are not (!) NA</span></span>
<span id="cb345-3"><a href="appendix---data-wrangling-and-visualisation.html#cb345-3" tabindex="-1"></a><span class="fu">mean</span>(x)</span></code></pre></div>
<pre><code>## [1] 4.166667</code></pre>
<p>What about our data.frame <code>df</code>? As <code>df</code> has both rows and columns we cannot simply use the same method but have to be more specific. For example, to remove a row where <code>df$x</code> contains missing data</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="appendix---data-wrangling-and-visualisation.html#cb347-1" tabindex="-1"></a>df[<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>x),]</span></code></pre></div>
<pre><code>##   x   y
## 1 1 0.2
## 2 4 0.5
## 3 2  NA
## 4 9 0.1
## 6 4 0.8
## 7 5 0.9</code></pre>
<p>or to remove all rows where either <code>df$x</code> <em>or</em> <code>df$y</code> contains missing data (note: for this we need a logical operator, which is in fact an <em>and</em>, <code>&amp;</code>, because we neither want NAâs in <code>x</code> nor in <code>y</code> so both conditions have to be safisfied together)</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="appendix---data-wrangling-and-visualisation.html#cb349-1" tabindex="-1"></a>df[<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>x) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>y),]</span></code></pre></div>
<pre><code>##   x   y
## 1 1 0.2
## 2 4 0.5
## 4 9 0.1
## 6 4 0.8
## 7 5 0.9</code></pre>
<p>An easier way to achieve the same is by using the <code>complete.cases()</code> function, which selects only those rows where we have complete information (i.e.Â no missing data)</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="appendix---data-wrangling-and-visualisation.html#cb351-1" tabindex="-1"></a>df[<span class="fu">complete.cases</span>(df),]</span></code></pre></div>
<pre><code>##   x   y
## 1 1 0.2
## 2 4 0.5
## 4 9 0.1
## 6 4 0.8
## 7 5 0.9</code></pre>
<p>And finally here the same examples but done using <code>tidy</code> functionality</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="appendix---data-wrangling-and-visualisation.html#cb353-1" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb353-2"><a href="appendix---data-wrangling-and-visualisation.html#cb353-2" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(x) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(y))</span></code></pre></div>
<pre><code>##   x   y
## 1 1 0.2
## 2 4 0.5
## 3 9 0.1
## 4 4 0.8
## 5 5 0.9</code></pre>
<p>which is equivalent to</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="appendix---data-wrangling-and-visualisation.html#cb355-1" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb355-2"><a href="appendix---data-wrangling-and-visualisation.html#cb355-2" tabindex="-1"></a>    <span class="fu">drop_na</span>()</span></code></pre></div>
<pre><code>##   x   y
## 1 1 0.2
## 2 4 0.5
## 3 9 0.1
## 4 4 0.8
## 5 5 0.9</code></pre>
<p>which is equivalent to</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="appendix---data-wrangling-and-visualisation.html#cb357-1" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb357-2"><a href="appendix---data-wrangling-and-visualisation.html#cb357-2" tabindex="-1"></a>  <span class="fu">filter_at</span>(<span class="fu">vars</span>(x<span class="sc">:</span>y), <span class="fu">all_vars</span>(<span class="sc">!</span><span class="fu">is.na</span>(.)))</span></code></pre></div>
<pre><code>##   x   y
## 1 1 0.2
## 2 4 0.5
## 3 9 0.1
## 4 4 0.8
## 5 5 0.9</code></pre>
<p>which is equivalent to</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="appendix---data-wrangling-and-visualisation.html#cb359-1" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb359-2"><a href="appendix---data-wrangling-and-visualisation.html#cb359-2" tabindex="-1"></a>  <span class="fu">filter_at</span>(<span class="fu">vars</span>(x<span class="sc">:</span>y), <span class="fu">all_vars</span>(<span class="fu">complete.cases</span>(.)))</span></code></pre></div>
<pre><code>##   x   y
## 1 1 0.2
## 2 4 0.5
## 3 9 0.1
## 4 4 0.8
## 5 5 0.9</code></pre>
<p>As they say in English: <em>âthere is more than one way to skin a catâ</em>.</p>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="appendix---general-introduction-to-rrstudio.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
